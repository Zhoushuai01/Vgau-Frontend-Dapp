import{_ as e,u as s,r as t,E as a,o,d as l,w as n,i as c,e as r,f as i,g as u,j as d,k as g,t as f,h as _,l as m,G as p,s as h,D as v,v as w,z as y,A as E,H as R,J as C,B as b}from"./index-BYz-dWzL.js";import{_ as k}from"./fuzhi.RGeIzCgF.js";import{f as S}from"./addressUtils.4RzFZbUF.js";import{a as O}from"./apiService.Bl7qyh6B.js";import{c as T}from"./walletService.Wy1Vg5c0.js";const A=e({__name:"Person",setup(e){const{t:A,locale:I}=s(),U=t(""),$=a({username:"User123",userId:"4561235154511515241"}),N=a({stakedVGAU:"12,456",stakingYield:"+123,456",collateralVGAU:"456",remainingDebt:"123"}),x=t("235"),D=t(!1),G=()=>{navigator.clipboard?navigator.clipboard.writeText(U.value).then((()=>{V(A("person.walletAddressCopied"))})).catch((()=>{P()})):P()},P=()=>{const e=document.createElement("textarea");e.value=U.value,document.body.appendChild(e),e.select();try{document.execCommand("copy"),V("Wallet address copied!")}catch(s){V("Copy failed")}document.body.removeChild(e)},V=e=>{w({title:e,icon:"success",duration:2e3})},j=e=>{console.error("图片加载失败:",e)},H=()=>{v({url:"/views/PointsDetails"})},W=()=>{v({url:"/views/Invitation"})},q=()=>{v({url:"/views/Exchange"})},M=()=>{v({url:"/views/Redeem"})},L=()=>{v({url:"/views/History"})},K=()=>{v({url:"/views/Settings"})},Y=async()=>{try{D.value=!0}catch(e){console.error("登出确认失败:",e)}},B=async()=>{try{D.value=!1,await J()}catch(e){console.error("确认登出失败:",e)}},J=async()=>{try{console.log("🚀 开始执行登出流程..."),y({title:A("person.logout.loading")});if(!(await z()).isConnected)throw new Error("NETWORK_ERROR: 网络连接失败");if(!(await F()).isLoggedIn)return console.log("⚠️ 用户未登录，直接清除本地数据"),se(),E(),w({title:"用户未登录，已清除本地数据",icon:"success",duration:1e3}),void R({url:"/pages/Home"});console.log("📡 调用登出接口...");const e=await O.logout();if(console.log("📡 登出接口响应:",e),E(),!e||!e.success){const s=Z(e);throw new Error(s)}console.log("✅ 登出接口调用成功"),w({title:A("person.logout.success"),icon:"success",duration:1e3}),se(),R({url:"/pages/Home"})}catch(e){console.error("❌ 登出失败:",e),E();const s=Q(e);X(s)}},z=async()=>{try{console.log("🌐 开始检测网络状态...");const e=await C({url:"/api/health",method:"GET",timeout:5e3});return console.log("✅ 网络检测成功:",e),{isConnected:!0,status:"connected",responseTime:Date.now(),statusCode:e.statusCode}}catch(e){console.log("❌ 网络检测失败:",e);try{const e=await C({url:"https://httpbin.org/get",method:"GET",timeout:3e3});return console.log("✅ 备用网络检测成功:",e),{isConnected:!0,status:"connected_via_backup",responseTime:Date.now(),statusCode:e.statusCode}}catch(s){return console.log("❌ 备用网络检测也失败:",s),{isConnected:!1,status:"disconnected",error:e.message,backupError:s.message}}}},F=async()=>{try{const e=await O.getMe();return{isLoggedIn:e&&e.success,userData:(null==e?void 0:e.data)||null}}catch(e){return console.log("🔍 检查登录状态失败:",e),{isLoggedIn:!1,userData:null,error:e.message}}},Z=e=>{if(console.log("🔍 分析登出失败原因:",e),!e)return"RESPONSE_MISSING: 接口返回数据为空";if(e.statusCode)switch(e.statusCode){case 401:return"UNAUTHORIZED: 用户未授权或token已过期";case 403:return"FORBIDDEN: 权限不足";case 404:return"NOT_FOUND: 登出接口不存在";case 500:return"SERVER_ERROR: 服务器内部错误";case 502:return"BAD_GATEWAY: 网关错误";case 503:return"SERVICE_UNAVAILABLE: 服务不可用";case 504:return"GATEWAY_TIMEOUT: 网关超时";default:return`HTTP_ERROR_${e.statusCode}: ${e.statusText||"未知错误"}`}return e.error?`API_ERROR: ${e.error}`:e.message?`MESSAGE: ${e.message}`:"UNKNOWN_ERROR: 未知错误"},Q=e=>{console.log("🔍 分析错误详情:",e);const s={type:"UNKNOWN",message:e.message||"未知错误",details:{},suggestions:[]};return e.message&&(e.message.includes("NETWORK_ERROR")?(s.type="NETWORK",s.suggestions=["检查网络连接","检查VPN设置","稍后重试"]):e.message.includes("UNAUTHORIZED")?(s.type="AUTH",s.suggestions=["重新登录","检查token是否过期","清除浏览器缓存"]):e.message.includes("SERVER_ERROR")?(s.type="SERVER",s.suggestions=["服务器维护中，请稍后重试","联系客服","检查服务状态"]):e.message.includes("TIMEOUT")&&(s.type="TIMEOUT",s.suggestions=["网络较慢，请稍后重试","检查网络连接","尝试切换网络"])),e.response&&(s.details.response={status:e.response.status,statusText:e.response.statusText,data:e.response.data}),e.request&&(s.details.request={method:e.request.method,url:e.request.url,headers:e.request.headers}),s},X=e=>{console.log("📋 显示详细错误信息:",e),ee(e);let s=`错误类型: ${e.type}\n错误信息: ${e.message}`;e.suggestions.length>0&&(s+="\n\n建议解决方案:\n"+e.suggestions.map(((e,s)=>`${s+1}. ${e}`)).join("\n")),b({title:"登出失败 - 错误详情",content:s,confirmText:"重试",cancelText:"关闭",success:e=>{e.confirm&&(console.log("🔄 用户选择重试登出"),J())}})},ee=e=>{const s={timestamp:(new Date).toISOString(),type:"LOGOUT_ERROR",errorInfo:e,userAgent:navigator.userAgent,url:window.location.href,timestamp:Date.now()};console.log("📝 登出错误日志:",s);try{const e=JSON.parse(localStorage.getItem("logout_error_logs")||"[]");e.push(s),e.length>10&&e.splice(0,e.length-10),localStorage.setItem("logout_error_logs",JSON.stringify(e)),console.log("💾 错误日志已保存到本地存储")}catch(t){console.error("保存错误日志失败:",t)}},se=()=>{if("undefined"!=typeof window){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&(s.includes("user")||s.includes("auth")||s.includes("login"))&&e.push(s)}e.forEach((e=>{localStorage.removeItem(e)}));const s=[];for(let t=0;t<sessionStorage.length;t++){const e=sessionStorage.key(t);e&&(e.includes("user")||e.includes("auth")||e.includes("login"))&&s.push(e)}s.forEach((e=>{sessionStorage.removeItem(e)}))}Object.assign($,{username:"",userId:""}),Object.assign(N,{stakedVGAU:"0",stakingYield:"0",collateralVGAU:"0",remainingDebt:"0"}),x.value="0",U.value=""};return o((async()=>{await(async()=>{try{console.log("🔍 获取连接的钱包地址...");const e=await T();e?(U.value=e,console.log("✅ 获取到钱包地址:",e)):(console.log("⚠️ 未检测到连接的钱包"),U.value="")}catch(e){console.error("获取钱包地址失败:",e),U.value=""}})(),U.value&&void 0!==window.ethereum&&(window.ethereum.on("accountsChanged",(e=>{console.log("🔄 钱包账户已切换:",e),e.length>0?(U.value=e[0],console.log("✅ 更新钱包地址:",e[0])):(U.value="",console.log("⚠️ 钱包已断开连接"))})),window.ethereum.on("chainChanged",(e=>{console.log("🔄 网络已切换:",e)}))),(async()=>{try{console.log("获取用户信息")}catch(e){console.error("获取用户信息失败:",e)}})(),(async()=>{try{console.log("获取资产信息")}catch(e){console.error("获取资产信息失败:",e)}})()})),(e,s)=>{const t=d,a=_,o=c,v=p;return r(),l(o,{class:"person-container"},{default:n((()=>[i(o,{class:"header"},{default:n((()=>[i(t,{class:"header-title"},{default:n((()=>[g(f(e.$t("person.title")),1)])),_:1}),i(o,{class:"header-actions"},{default:n((()=>[i(o,{class:"header-btn",onClick:L},{default:n((()=>[i(a,{src:"/static/Person/History.png",class:"header-icon"})])),_:1}),i(o,{class:"header-btn"},{default:n((()=>[i(a,{src:"/static/Person/Service.png",class:"header-icon"})])),_:1}),i(o,{class:"header-btn logout-btn",onClick:Y},{default:n((()=>[i(t,{class:"logout-text"},{default:n((()=>[g(f(m(A)("person.logout.button")),1)])),_:1})])),_:1})])),_:1})])),_:1}),i(o,{class:"main-content"},{default:n((()=>[i(o,{class:"user-card"},{default:n((()=>[i(o,{class:"user-info"},{default:n((()=>[i(o,{class:"user-details"},{default:n((()=>[i(t,{class:"username"},{default:n((()=>[g(f($.username),1)])),_:1}),i(t,{class:"user-id"},{default:n((()=>[g(f($.userId),1)])),_:1})])),_:1})])),_:1}),i(o,{class:"wallet-section"},{default:n((()=>[i(o,{class:"wallet-info"},{default:n((()=>[i(t,{class:"wallet-label"},{default:n((()=>[g(f(e.$t("person.walletAddress")),1)])),_:1}),U.value?(r(),l(t,{key:0,class:"wallet-address"},{default:n((()=>[g(f(m(S)(U.value)),1)])),_:1})):(r(),l(t,{key:1,class:"wallet-address no-wallet"},{default:n((()=>[g(f(e.$t("person.noWalletConnected")),1)])),_:1}))])),_:1}),U.value?(r(),l(o,{key:0,class:"copy-btn",onClick:G},{default:n((()=>[i(a,{src:k,class:"copy-icon"})])),_:1})):u("",!0)])),_:1})])),_:1}),i(o,{class:"quick-actions"},{default:n((()=>[i(o,{class:"action-item",onClick:q},{default:n((()=>[i(o,{class:"action-icon exchange-icon"},{default:n((()=>[i(a,{src:"/static/Person/Exchange.png",class:"action-icon-img"})])),_:1}),i(t,{class:"action-label"},{default:n((()=>[g(f(e.$t("person.menu.exchange")),1)])),_:1})])),_:1}),i(o,{class:"action-item",onClick:M},{default:n((()=>[i(o,{class:"action-icon redeem-icon"},{default:n((()=>[i(a,{src:"/static/Person/Redeem.png",class:"action-icon-img"})])),_:1}),i(t,{class:"action-label"},{default:n((()=>[g(f(e.$t("person.menu.redeem")),1)])),_:1})])),_:1}),i(o,{class:"action-item",onClick:W},{default:n((()=>[i(o,{class:"action-icon invite-icon"},{default:n((()=>[i(a,{src:"/static/Person/Invite.png",class:"action-icon-img"})])),_:1}),i(t,{class:"action-label"},{default:n((()=>[g(f(e.$t("person.menu.invite")),1)])),_:1})])),_:1}),i(o,{class:"action-item",onClick:H},{default:n((()=>[i(o,{class:"action-icon points-icon"},{default:n((()=>[i(a,{src:"/static/Person/Points.png",class:"action-icon-img"})])),_:1}),i(t,{class:"action-label"},{default:n((()=>[g(f(e.$t("person.menu.points")),1)])),_:1})])),_:1})])),_:1}),i(o,{class:"section-title"},{default:n((()=>[i(t,{class:"title-text"},{default:n((()=>[g(f(e.$t("person.assetOverview")),1)])),_:1})])),_:1}),i(o,{class:"assets-grid"},{default:n((()=>[i(o,{class:"asset-card"},{default:n((()=>[i(t,{class:"asset-label"},{default:n((()=>[g(f(e.$t("person.currentStakedAmount")),1)])),_:1}),i(t,{class:"asset-unit"},{default:n((()=>[g("VGAU")])),_:1}),i(t,{class:"asset-value"},{default:n((()=>[g(f(N.stakedVGAU),1)])),_:1})])),_:1}),i(o,{class:"asset-card"},{default:n((()=>[i(t,{class:"asset-label"},{default:n((()=>[g(f(e.$t("person.totalStakedRewards")),1)])),_:1}),i(t,{class:"asset-unit"},{default:n((()=>[g("USDT")])),_:1}),i(t,{class:"asset-value"},{default:n((()=>[g(f(N.stakingYield),1)])),_:1})])),_:1}),i(o,{class:"asset-card"},{default:n((()=>[i(t,{class:"asset-label"},{default:n((()=>[g(f(e.$t("person.currentCollateral")),1)])),_:1}),i(t,{class:"asset-unit"},{default:n((()=>[g("VGAU")])),_:1}),i(t,{class:"asset-value"},{default:n((()=>[g(f(N.collateralVGAU),1)])),_:1})])),_:1}),i(o,{class:"asset-card"},{default:n((()=>[i(t,{class:"asset-label"},{default:n((()=>[g(f(e.$t("person.remainingDebt")),1)])),_:1}),i(t,{class:"asset-unit"},{default:n((()=>[g("USDT")])),_:1}),i(t,{class:"asset-value"},{default:n((()=>[g(f(N.remainingDebt),1)])),_:1})])),_:1})])),_:1}),i(o,{class:"points-section"},{default:n((()=>[i(t,{class:"points-label"},{default:n((()=>[g(f(e.$t("person.totalPoints")),1)])),_:1}),i(t,{class:"points-value"},{default:n((()=>[g(f(x.value),1)])),_:1})])),_:1}),i(o,{class:"notification-card"},{default:n((()=>[i(o,{class:"notification-header"},{default:n((()=>[i(o,{class:"notification-icon"},{default:n((()=>[i(a,{src:"/static/Person/Notice.png",class:"icon-img"})])),_:1}),i(t,{class:"notification-title"},{default:n((()=>[g(f(e.$t("person.notificationCenter")),1)])),_:1})])),_:1}),i(o,{class:"notification-content"},{default:n((()=>[i(t,{class:"notification-text"},{default:n((()=>[g(f(e.$t("person.liquidationAlert")),1)])),_:1})])),_:1}),i(o,{class:"notification-divider"}),i(o,{class:"notification-action"},{default:n((()=>[i(v,{class:"action-button"},{default:n((()=>[g(f(e.$t("person.topUpNow")),1)])),_:1})])),_:1})])),_:1}),i(o,{class:"more-settings"},{default:n((()=>[i(o,{class:"settings-left",onClick:K},{default:n((()=>[i(a,{src:"/static/Person/More-Settings.png",class:"settings-btn-icon",onError:j}),i(t,{class:"settings-text"},{default:n((()=>[g(f(e.$t("person.moreSettings")),1)])),_:1})])),_:1})])),_:1})])),_:1}),D.value?(r(),l(o,{key:0,class:"modal-overlay",onClick:s[2]||(s[2]=e=>D.value=!1)},{default:n((()=>[i(o,{class:"modal-content",onClick:s[1]||(s[1]=h((()=>{}),["stop"]))},{default:n((()=>[i(o,{class:"modal-text"},{default:n((()=>[i(t,{class:"logout-title"},{default:n((()=>[g(f(m(A)("person.logoutConfirm.title")),1)])),_:1}),i(t,{class:"logout-desc"},{default:n((()=>[g(f(m(A)("person.logoutConfirm.content")),1)])),_:1})])),_:1}),i(o,{class:"modal-actions"},{default:n((()=>[i(o,{class:"modal-btn outline",onClick:s[0]||(s[0]=e=>D.value=!1)},{default:n((()=>[g(f(m(A)("person.logoutConfirm.cancel")),1)])),_:1}),i(o,{class:"modal-btn solid",onClick:B},{default:n((()=>[g(f(m(A)("person.logoutConfirm.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1})):u("",!0)])),_:1})}}},[["__scopeId","data-v-e1209e4f"]]);export{A as default};
