import{_ as e,u as t,r as a,o as s,d as n,w as l,v as o,i as c,e as i,f as r,h as u,j as d,k as m,t as f,l as k,m as _,F as y,p,n as T,M as g,D as S,B as b,z as v,A as w}from"./index-BYz-dWzL.js";import{_ as h}from"./back.BFYz81iB.js";import{_ as F}from"./history.BXkQwhl1.js";import{s as x}from"./apiService.Bl7qyh6B.js";const A=e({__name:"MyFinance",setup(e){const{t:A}=t(),E=a([]),D=a(!1),I=async()=>{D.value=!0;try{const e=await x.getOrders();console.log("质押订单列表:",e);let t=[];t=e&&e.data?e.data:[{id:1,firstStakeTime:"2025-01-15T10:30:00Z",lastStakeTime:"2025-02-15T10:30:00Z",totalStakeAmount:"100",totalInterestEarned:"5.5",status:"staking"},{id:2,firstStakeTime:"2025-01-20T14:20:00Z",lastStakeTime:"2024-12-20T14:20:00Z",totalStakeAmount:"200",totalInterestEarned:"12.0",status:"staking"}],E.value=t.map((e=>{console.log("处理订单:",e);const t={...e,firstStakeTime:e.firstStakeTime||e.startTime||"",lastStakeTime:e.lastStakeTime||e.endTime||"",totalStakeAmount:e.totalStakeAmount||e.stakeAmount||"0",totalInterestEarned:e.totalInterestEarned||e.interestEarned||"0"};return console.log("映射后的订单:",t),t})),console.log("最终订单列表:",E.value)}catch(e){console.error("获取质押订单失败:",e),o({title:"获取数据失败",icon:"none",duration:2e3})}finally{D.value=!1}},j=e=>{if(!e)return"暂无";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("zh-CN")}catch(t){return console.error("时间格式化错误:",t),e||"暂无"}},C=e=>{if(!e)return!1;try{const t=new Date(e);return t<=new Date}catch(t){return console.error("检查订单到期时间错误:",t),!1}},N=e=>C(e.lastStakeTime)?"redeemable":e.status||"staking",U=e=>{switch(N(e)){case"redeemable":return"redeemable-btn";case"staking":default:return"staking-btn";case"completed":return"completed-btn"}},Z=e=>{switch(N(e)){case"redeemable":return A("components.myFinance.redeemable");case"staking":default:return A("components.myFinance.staking");case"completed":return"已完成"}},z=()=>{g()},G=()=>{S({url:"/views/History"})},L=async e=>{try{v({title:"赎回中...",mask:!0}),console.log("开始赎回订单:",e.id);const t=await x.redeemOrder(e.id);if(console.log("赎回响应:",t),w(),!t||!t.success)throw new Error((null==t?void 0:t.message)||"赎回失败");o({title:"赎回成功",icon:"success",duration:2e3}),await I()}catch(t){console.error("赎回订单失败:",t),w(),o({title:t.message||"赎回失败，请稍后重试",icon:"none",duration:3e3})}};return s((()=>{I()})),(e,t)=>{const a=u,s=c,g=d;return i(),n(s,{class:"content"},{default:l((()=>[r(s,{class:"header"},{default:l((()=>[r(s,{class:"back-button",onClick:z},{default:l((()=>[r(a,{class:"back-icon",src:h,mode:"aspectFit"})])),_:1}),r(s,{class:"page-title"},{default:l((()=>[r(g,{class:"title-text"},{default:l((()=>[m(f(k(A)("components.myFinance.title")),1)])),_:1})])),_:1}),r(s,{class:"history-button",onClick:G},{default:l((()=>[r(a,{class:"history-icon",src:F,mode:"aspectFit"})])),_:1})])),_:1}),r(s,{class:"main-content"},{default:l((()=>[r(s,{class:"redemption-notice"},{default:l((()=>[r(g,{class:"notice-text"},{default:l((()=>[m(f(k(A)("components.myFinance.redemptionNotice")),1)])),_:1})])),_:1}),D.value?(i(),n(s,{key:0,class:"loading-container"},{default:l((()=>[r(g,{class:"loading-text"},{default:l((()=>[m("加载中...")])),_:1})])),_:1})):E.value.length>0?(i(),n(s,{key:1},{default:l((()=>[(i(!0),_(y,null,p(E.value,((e,t)=>(i(),n(s,{key:t,class:"asset-card"},{default:l((()=>[r(s,{class:"asset-info"},{default:l((()=>[r(s,{class:"info-row"},{default:l((()=>[r(g,{class:"info-label"},{default:l((()=>[m(f(k(A)("components.myFinance.asset")),1)])),_:1}),r(g,{class:"info-value"},{default:l((()=>[m(f(e.totalStakeAmount||"0")+" VGAU",1)])),_:2},1024)])),_:2},1024),r(s,{class:"info-row"},{default:l((()=>[r(g,{class:"info-label"},{default:l((()=>[m(f(k(A)("components.myFinance.maturityYield")),1)])),_:1}),r(g,{class:"info-value"},{default:l((()=>[m(f(e.totalInterestEarned||"0")+" USDT",1)])),_:2},1024)])),_:2},1024),r(s,{class:"info-row"},{default:l((()=>[r(g,{class:"info-label"},{default:l((()=>[m(f(k(A)("components.myFinance.startTime")),1)])),_:1}),r(g,{class:"info-value"},{default:l((()=>[m(f(j(e.firstStakeTime)),1)])),_:2},1024)])),_:2},1024),r(s,{class:"info-row"},{default:l((()=>[r(g,{class:"info-label"},{default:l((()=>[m(f(k(A)("components.myFinance.endTime")),1)])),_:1}),r(g,{class:"info-value"},{default:l((()=>[m(f(j(e.lastStakeTime)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(s,{class:T(["status-button",U(e)]),onClick:t=>"redeemable"===N(e)?(async e=>{C(e.lastStakeTime)?b({title:"确认赎回",content:`确定要赎回 ${e.totalStakeAmount} VGAU 吗？赎回后将获得 ${e.totalInterestEarned} USDT 收益。`,confirmText:"确认赎回",cancelText:"取消",success:async t=>{t.confirm&&await L(e)}}):o({title:"订单尚未到期，无法赎回",icon:"none",duration:2e3})})(e):null},{default:l((()=>[r(g,{class:"status-text"},{default:l((()=>[m(f(Z(e)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})):(i(),n(s,{key:2,class:"empty-state"},{default:l((()=>[r(g,{class:"empty-text"},{default:l((()=>[m("暂无质押订单")])),_:1})])),_:1})),r(s,{class:"loading-status"},{default:l((()=>[r(g,{class:"loading-text"},{default:l((()=>[m(f(k(A)("components.myFinance.allLoaded")),1)])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-dc6671b8"]]);export{A as default};
