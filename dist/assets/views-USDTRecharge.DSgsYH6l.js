import{_ as a,r as e,u as t,o as l,v as s,d as c,w as r,i as n,e as o,f as i,h as u,j as d,k as f,t as g,g as m,I as h,n as _,s as p,l as v,M as y,z as b,A as P}from"./index-BYz-dWzL.js";import{_ as k}from"./back.BFYz81iB.js";import{_ as x}from"./USDT.DM1LJ6-W.js";import{c as S}from"./contractService.ChR1Iy-b.js";import"./BEP20USDT.4l3CktaQ.js";import"./apiService.Bl7qyh6B.js";import"./VGAUPlatformRecharge.BXpF-dn-.js";const j=a({__name:"USDTRecharge",setup(a){const j=e(""),w=e("0.000000"),U=e(!1),D=e(""),F=e(!1),T=e(""),{t:C}=t();l((async()=>{try{await $(),await A()}catch(a){console.error("页面初始化失败:",a)}}));const $=async()=>{try{U.value=!0,await S.init(),console.log("✅ 合约服务初始化成功")}catch(a){console.error("❌ 合约服务初始化失败:",a),s({title:C("rechargePage.contractInitFailed"),icon:"none",duration:3e3})}finally{U.value=!1}},A=async()=>{try{const a=await S.getUSDTBalance();w.value=a.formatted;const e=await S.getNetworkInfo();D.value=e.currentAccount,console.log("✅ 用户数据加载成功")}catch(a){console.error("❌ 用户数据加载失败:",a)}},I=()=>{y()},R=async()=>{if(!j.value||parseFloat(j.value)<=0)return void s({title:C("rechargePage.pleaseEnterValidAmount"),icon:"none",duration:2e3});const a=parseFloat(j.value);try{U.value=!0,T.value=a.toString(),F.value=!0}catch(e){console.error("充值操作失败:",e),s({title:C("rechargePage.rechargeFailed"),icon:"none",duration:3e3})}finally{U.value=!1}},V=async()=>{const a=T.value;F.value=!1,await(async a=>{try{U.value=!0,b({title:C("recharge.loading"),mask:!0});const e=await S.completeUSDTRecharge(a);P(),e&&e.transactionHash&&(s({title:C("rechargePage.rechargeSuccess"),icon:"success",duration:3e3}),await A(),j.value="",y())}catch(e){P(),console.error("❌ 充值执行失败:",e);let a=C("rechargePage.rechargeFailed");e.message.includes("insufficient funds")?a=C("rechargePage.insufficientFunds"):e.message.includes("user rejected")?a=C("rechargePage.userRejected"):e.message.includes("gas")&&(a=C("rechargePage.gasInsufficient")),s({title:a,icon:"none",duration:3e3})}finally{U.value=!1}})(a)};return(a,e)=>{const t=u,l=n,s=d,y=h;return o(),c(l,{class:"content"},{default:r((()=>[i(l,{class:"header"},{default:r((()=>[i(l,{class:"back-button",onClick:I},{default:r((()=>[i(t,{class:"back-icon",src:k,mode:"aspectFit"})])),_:1}),i(l,{class:"page-title"},{default:r((()=>[i(t,{class:"title-icon",src:x,mode:"aspectFit"}),i(s,{class:"title-text"},{default:r((()=>[f(g(a.$t("rechargePage.usdtRecharge")),1)])),_:1})])),_:1})])),_:1}),i(l,{class:"main-content"},{default:r((()=>[i(l,{class:"input-section"},{default:r((()=>[i(l,{class:"input-label"},{default:r((()=>[i(s,{class:"label-text"},{default:r((()=>[f(g(a.$t("rechargePage.amount")),1)])),_:1})])),_:1}),i(l,{class:"input-container"},{default:r((()=>[i(l,{class:"input-field"},{default:r((()=>[i(l,{class:"input-border"},{default:r((()=>[i(l,{class:"input-left"},{default:r((()=>[i(y,{class:"input-field-text",type:"number",placeholder:a.$t("rechargePage.minimumAmount"),"placeholder-style":"color: rgba(255, 255, 255, 0.2); font-size: 32rpx;",modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=a=>j.value=a)},null,8,["placeholder","modelValue"])])),_:1}),i(l,{class:"input-currency"},{default:r((()=>[i(s,{class:"currency-text"},{default:r((()=>[f("USDT |"+g(a.$t("rechargePage.max")),1)])),_:1})])),_:1})])),_:1})])),_:1}),i(l,{class:"balance-info"},{default:r((()=>[i(l,{class:"balance-label"},{default:r((()=>[i(s,{class:"balance-text"},{default:r((()=>[f(g(a.$t("rechargePage.availableBalance")),1)])),_:1})])),_:1}),i(l,{class:"balance-amount"},{default:r((()=>[i(s,{class:"amount-text"},{default:r((()=>[f(g(w.value)+" USDT",1)])),_:1})])),_:1})])),_:1}),i(l,{class:"divider"})])),_:1})])),_:1}),i(l,{class:"confirm-section"},{default:r((()=>[i(l,{class:_(["confirm-button",{disabled:U.value}]),onClick:R},{default:r((()=>[i(s,{class:"confirm-text"},{default:r((()=>[f(g(U.value?a.$t("rechargePage.processing"):a.$t("rechargePage.confirm")),1)])),_:1})])),_:1},8,["class"])])),_:1}),F.value?(o(),c(l,{key:0,class:"modal-overlay",onClick:e[3]||(e[3]=a=>F.value=!1)},{default:r((()=>[i(l,{class:"modal-content",onClick:e[2]||(e[2]=p((()=>{}),["stop"]))},{default:r((()=>[i(l,{class:"modal-text"},{default:r((()=>[i(s,{class:"recharge-title"},{default:r((()=>[f(g(v(C)("recharge.modal.title")),1)])),_:1}),i(s,{class:"recharge-desc"},{default:r((()=>[f(g(v(C)("recharge.modal.content",{amount:T.value,symbol:"USDT"})),1)])),_:1})])),_:1}),i(l,{class:"modal-actions"},{default:r((()=>[i(l,{class:"modal-btn outline",onClick:e[1]||(e[1]=a=>F.value=!1)},{default:r((()=>[f(g(v(C)("recharge.modal.cancel")),1)])),_:1}),i(l,{class:_(["modal-btn solid",{disabled:U.value}]),onClick:V},{default:r((()=>[f(g(v(C)("recharge.modal.confirm")),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-4c993e69"]]);export{j as default};
