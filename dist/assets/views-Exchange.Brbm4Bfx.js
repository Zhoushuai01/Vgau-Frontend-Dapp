import{_ as e,u as a,r as l,N as s,o as t,d as r,w as c,i as n,e as o,f as u,g as i,h as d,j as f,k as g,t as m,l as h,I as v,n as _,s as x,M as p,v as b,z as y,A as E,y as k}from"./index-BYz-dWzL.js";import{_ as T}from"./back.BFYz81iB.js";import{c as U}from"./contractExchange.Ckv1YkvP.js";import"./BEP20USDT.4l3CktaQ.js";const w=e({__name:"Exchange",setup(e){const{t:w}=a(),C=()=>{var e;try{return((null==(e=k.global.locale)?void 0:e.value)||"en").startsWith("zh")?"正在兌換...":"Exchanging..."}catch(a){return"Exchanging..."}},S=()=>{var e;try{return((null==(e=k.global.locale)?void 0:e.value)||"en").startsWith("zh")?"錯誤":"Error"}catch(a){return"Error"}},D=()=>{var e;try{return((null==(e=k.global.locale)?void 0:e.value)||"en").startsWith("zh")?"確認":"Confirm"}catch(a){return"Confirm"}},V=e=>{var a;try{const l=((null==(a=k.global.locale)?void 0:a.value)||"en").startsWith("zh");if("KYC_REQUIRED"===e.errorType)return e.message;if(e.message){if(e.message.includes("余额不足")||e.message.includes("Insufficient balance"))return e.message;if(e.message.includes("用户取消")||e.message.includes("User rejected"))return l?"用戶取消操作":"User Cancelled Operation";if(e.message.includes("网络")||e.message.includes("network"))return l?"網絡錯誤":"Network Error";if(e.message.includes("Gas")||e.message.includes("gas"))return l?"Gas費用不足":"Insufficient Gas Fee"}return l?"兌換失敗":"Exchange Failed"}catch(l){return"Exchange Failed"}},j=()=>{var e;try{return((null==(e=k.global.locale)?void 0:e.value)||"en").startsWith("zh")?"兌換成功":"Exchange Successful"}catch(a){return"Exchange Successful"}},z=()=>{var e;try{return((null==(e=k.global.locale)?void 0:e.value)||"en").startsWith("zh")?"請輸入有效金額":"Please Enter Valid Amount"}catch(a){return"Please Enter Valid Amount"}},F=l(""),A=l(!1),G=l(120),W=l(!1),q=l({title:"",message:"",confirmText:""}),I=l("0"),P=async()=>{if(!F.value||parseFloat(F.value)<=0)b({title:z(),icon:"none",duration:2e3});else if(!A.value)try{A.value=!0,y({title:C(),mask:!0}),console.log("🚀 开始USDT兑换VGAU流程..."),console.log("兑换数量:",F.value,"VGAU");const e=await U.exchangeUsdtToVgau(F.value);E(),console.log("✅ 兑换成功:",e),b({title:j(),icon:"success",duration:3e3}),F.value="",setTimeout((()=>{p()}),2e3)}catch(e){console.error("❌ 兑换失败:",e),E(),q.value={title:S(),message:V(e),confirmText:D()},W.value=!0}finally{A.value=!1}},N=()=>{p()},R=()=>{W.value=!1};return s(F,(()=>{(async()=>{if(F.value&&!isNaN(F.value))try{const e=parseFloat(F.value);console.log("🔍 计算所需USDT:",e);const a=await U.getRequiredUSDT(e);console.log("📊 计算结果:",a),I.value=a.formatted.toFixed(2)}catch(e){console.error("计算所需USDT失败:",e),I.value="0"}else I.value="0"})()}),{immediate:!1}),t((async()=>{try{await(async()=>{try{const e=await U.getLatestGoldPrice();G.value=parseFloat(e)/Math.pow(10,8),console.log("获取到最新黄金价格:",G.value)}catch(e){console.error("获取价格失败:",e),G.value=120}})()}catch(e){console.error("初始化价格失败:",e)}})),(e,a)=>{const l=d,s=n,t=f,p=v;return o(),r(s,{class:"exchange-container"},{default:c((()=>[u(s,{class:"page-header"},{default:c((()=>[u(s,{class:"back-button",onClick:N},{default:c((()=>[u(s,{class:"back-icon"},{default:c((()=>[u(l,{src:T,class:"back-arrow"})])),_:1})])),_:1}),u(t,{class:"title-text"},{default:c((()=>[g(m(h(w)("components.exchange.title")),1)])),_:1})])),_:1}),u(s,{class:"brand-section"},{default:c((()=>[u(s,{class:"brand-info"},{default:c((()=>[u(t,{class:"brand-title"},{default:c((()=>[g(m(h(w)("components.exchange.brandTitle")),1)])),_:1}),u(t,{class:"brand-subtitle"},{default:c((()=>[g(m(h(w)("components.exchange.brandSubtitle")),1)])),_:1}),u(t,{class:"brand-description"},{default:c((()=>[g(m(h(w)("components.exchange.brandDescription")),1)])),_:1})])),_:1}),u(s,{class:"rate-info"},{default:c((()=>[u(s,{class:"rate-info-content"},{default:c((()=>[u(t,{class:"rate-text"},{default:c((()=>[g(m(h(w)("components.exchange.rateText")),1)])),_:1})])),_:1}),u(s,{class:"divider-line"})])),_:1})])),_:1}),u(s,{class:"exchange-section"},{default:c((()=>[u(s,{class:"currency-selector"},{default:c((()=>[u(t,{class:"currency-text"},{default:c((()=>[g(m(h(w)("components.exchange.currency1")),1)])),_:1}),u(s,{class:"exchange-icon"},{default:c((()=>[u(t,{class:"arrow-icon"},{default:c((()=>[g("→")])),_:1})])),_:1}),u(t,{class:"currency-text"},{default:c((()=>[g(m(h(w)("components.exchange.currency2")),1)])),_:1})])),_:1}),u(s,{class:"input-container"},{default:c((()=>[u(s,{class:"input-field"},{default:c((()=>[u(p,{class:"input-text",type:"number",modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value=e),placeholder:h(w)("components.exchange.exchangeAmountPlaceholder"),"placeholder-class":"placeholder-text","adjust-position":!1,"hold-keyboard":!0,"cursor-spacing":200},null,8,["modelValue","placeholder"]),u(t,{class:"currency-label"},{default:c((()=>[g(m(h(w)("components.exchange.currency2")),1)])),_:1})])),_:1})])),_:1}),u(s,{class:"required-info"},{default:c((()=>[u(t,{class:"required-label"},{default:c((()=>[g(m(h(w)("components.exchange.requiredUSDT")),1)])),_:1}),u(t,{class:"required-value"},{default:c((()=>[g(m(I.value),1)])),_:1})])),_:1})])),_:1}),u(s,{class:_(["confirm-btn",{loading:A.value}]),onClick:P},{default:c((()=>[u(t,{class:"confirm-text"},{default:c((()=>[g(m(A.value?C():h(w)("components.exchange.confirmExchange")),1)])),_:1})])),_:1},8,["class"]),W.value?(o(),r(s,{key:0,class:"custom-error-modal",onClick:R},{default:c((()=>[u(s,{class:"error-modal-content",onClick:a[1]||(a[1]=x((()=>{}),["stop"]))},{default:c((()=>[u(s,{class:"error-header"},{default:c((()=>[u(t,{class:"error-title"},{default:c((()=>[g(m(q.value.title),1)])),_:1})])),_:1}),u(s,{class:"error-body"},{default:c((()=>[u(t,{class:"error-message"},{default:c((()=>[g(m(q.value.message),1)])),_:1})])),_:1}),u(s,{class:"error-footer"},{default:c((()=>[u(s,{class:"error-confirm-btn",onClick:R},{default:c((()=>[u(t,{class:"error-confirm-text"},{default:c((()=>[g(m(q.value.confirmText),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-e2460b17"]]);export{w as default};
