import{w as e,U as o,V as t}from"./BEP20USDT.4l3CktaQ.js";import{a as r}from"./apiService.Bl7qyh6B.js";import{V as s}from"./VGAUPlatformRecharge.BXpF-dn-.js";const n=new class{constructor(){this.isInitialized=!1,this.setupEventListeners()}setupEventListeners(){window.addEventListener("walletBindingCheck",this.handleWalletBindingCheck.bind(this))}async handleWalletBindingCheck(e){const{account:o,chainId:t,source:r}=e.detail;if(console.log("ğŸ” å¼€å§‹æ£€æµ‹é’±åŒ…ç»‘å®šçŠ¶æ€:",{account:o,chainId:t,source:r}),o)try{this.clearLocalCache();const e=await this.checkWalletBindingStatus(o,t);this.triggerBindingStatusUpdate(e),console.log("âœ… é’±åŒ…ç»‘å®šçŠ¶æ€æ£€æµ‹å®Œæˆ:",e)}catch(s){console.error("âŒ é’±åŒ…ç»‘å®šçŠ¶æ€æ£€æµ‹å¤±è´¥:",s),this.triggerBindingError(s)}else console.log("âŒ æ— æ•ˆçš„é’±åŒ…åœ°å€")}async checkWalletBindingStatus(e,o){try{console.log("ğŸ” æ£€æµ‹é’±åŒ…åœ°å€ç»‘å®šçŠ¶æ€:",e);const t=await this.checkUserLoginStatus();if(t.isLoggedIn)return console.log("âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œæ£€æŸ¥é’±åŒ…åœ°å€åŒ¹é…"),t.userData.walletAddress===e?{isBound:!0,isLoggedIn:!0,userData:t.userData,walletAddress:e,message:"é’±åŒ…åœ°å€å·²ç»‘å®šå¹¶å·²ç™»å½•"}:(console.log("âš ï¸ é’±åŒ…åœ°å€ä¸åŒ¹é…ï¼Œéœ€è¦é‡æ–°ç™»å½•"),{isBound:!1,isLoggedIn:!1,walletAddress:e,message:"é’±åŒ…åœ°å€å·²åˆ‡æ¢ï¼Œéœ€è¦é‡æ–°ç™»å½•"});console.log("ğŸ” ç”¨æˆ·æœªç™»å½•ï¼Œå°è¯•é’±åŒ…ç™»å½•");return await this.attemptWalletLogin(e,o)}catch(t){throw console.error("æ£€æµ‹é’±åŒ…ç»‘å®šçŠ¶æ€å¤±è´¥:",t),t}}async checkUserLoginStatus(){try{console.log("ğŸ” å¼ºåˆ¶ä»åç«¯è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€...");const e=await r.getMe();return e&&e.success?(console.log("âœ… ä»åç«¯è·å–åˆ°ç”¨æˆ·æ•°æ®:",e.data),{isLoggedIn:!0,userData:e.data}):(console.log("âŒ åç«¯è¿”å›ç”¨æˆ·æœªç™»å½•çŠ¶æ€"),{isLoggedIn:!1,userData:null})}catch(e){return console.error("âŒ è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€å¤±è´¥:",e),{isLoggedIn:!1,userData:null}}}async attemptWalletLogin(e,o){try{return console.log("ğŸ” å°è¯•é’±åŒ…ç™»å½•:",{walletAddress:e,chainId:o}),{isBound:!1,isLoggedIn:!1,walletAddress:e,message:"éœ€è¦ç”¨æˆ·ç­¾åè¿›è¡Œé’±åŒ…ç™»å½•",requiresSignature:!0,nextStep:'è¯·ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®è¿›è¡Œç™»å½•'}}catch(t){console.error("âŒ é’±åŒ…ç™»å½•å°è¯•å¤±è´¥:",t);const r=this.analyzeWalletLoginError(t,e,o);return{isBound:!1,isLoggedIn:!1,walletAddress:e,message:r.userMessage,error:t.message,errorCode:r.errorCode,errorType:r.errorType,suggestions:r.suggestions,requiresSignature:!1,canRetry:r.canRetry}}}analyzeWalletLoginError(e,o,t){console.log("ğŸ” åˆ†æé’±åŒ…ç™»å½•é”™è¯¯:",e);const r={errorCode:"UNKNOWN_ERROR",errorType:"UNKNOWN",userMessage:"é’±åŒ…ç™»å½•å¤±è´¥",suggestions:[],canRetry:!0};if(e.message){const o=e.message.toLowerCase();o.includes("network")||o.includes("fetch")||o.includes("timeout")?(r.errorCode="NETWORK_ERROR",r.errorType="NETWORK",r.userMessage="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®",r.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","æ£€æŸ¥VPNè®¾ç½®","å°è¯•åˆ‡æ¢ç½‘ç»œ","ç¨åé‡è¯•"],r.canRetry=!0):o.includes("wallet")||o.includes("metamask")||o.includes("provider")?(r.errorCode="WALLET_CONNECTION_ERROR",r.errorType="WALLET",r.userMessage="é’±åŒ…è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é’±åŒ…çŠ¶æ€",r.suggestions=["ç¡®ä¿MetaMaskå·²å®‰è£…å¹¶è§£é”","æ£€æŸ¥é’±åŒ…æ˜¯å¦è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œ","å°è¯•é‡æ–°è¿æ¥é’±åŒ…","åˆ·æ–°é¡µé¢åé‡è¯•"],r.canRetry=!0):o.includes("user rejected")||o.includes("user denied")||o.includes("cancel")?(r.errorCode="USER_REJECTED",r.errorType="USER_ACTION",r.userMessage="ç”¨æˆ·å–æ¶ˆäº†é’±åŒ…è¿æ¥æ“ä½œ",r.suggestions=['è¯·é‡æ–°ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®',"åœ¨MetaMaskä¸­ç¡®è®¤è¿æ¥è¯·æ±‚","æ£€æŸ¥MetaMaskå¼¹çª—æ˜¯å¦è¢«é˜»æ­¢"],r.canRetry=!0):o.includes("chain")||o.includes("network")||o.includes("unsupported")?(r.errorCode="CHAIN_ID_ERROR",r.errorType="NETWORK",r.userMessage="ç½‘ç»œä¸æ”¯æŒï¼Œè¯·åˆ‡æ¢åˆ°æ­£ç¡®çš„ç½‘ç»œ",r.suggestions=["åˆ‡æ¢åˆ°BSCæµ‹è¯•ç½‘ (Chain ID: 97)","æ£€æŸ¥é’±åŒ…ç½‘ç»œè®¾ç½®","ç¡®ä¿ç½‘ç»œé…ç½®æ­£ç¡®"],r.canRetry=!0):o.includes("signature")||o.includes("sign")||o.includes("personal_sign")?(r.errorCode="SIGNATURE_ERROR",r.errorType="SIGNATURE",r.userMessage="æ¶ˆæ¯ç­¾åå¤±è´¥ï¼Œè¯·é‡è¯•",r.suggestions=["åœ¨MetaMaskä¸­ç¡®è®¤ç­¾åè¯·æ±‚","æ£€æŸ¥ç­¾åæ¶ˆæ¯å†…å®¹","é‡æ–°å°è¯•ç­¾åæ“ä½œ"],r.canRetry=!0):o.includes("server")||o.includes("500")||o.includes("502")||o.includes("503")?(r.errorCode="SERVER_ERROR",r.errorType="SERVER",r.userMessage="æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•",r.suggestions=["ç¨åé‡è¯•","æ£€æŸ¥æœåŠ¡çŠ¶æ€","è”ç³»å®¢æœæ”¯æŒ"],r.canRetry=!0):o.includes("unauthorized")||o.includes("401")||o.includes("auth")?(r.errorCode="AUTH_ERROR",r.errorType="AUTH",r.userMessage="è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•",r.suggestions=["é‡æ–°è¿æ¥é’±åŒ…","æ¸…é™¤æµè§ˆå™¨ç¼“å­˜","æ£€æŸ¥ç™»å½•çŠ¶æ€"],r.canRetry=!0):o.includes("not bound")||o.includes("wallet not bound")?(r.errorCode="WALLET_NOT_BOUND",r.errorType="BINDING",r.userMessage="è¯¥é’±åŒ…åœ°å€æœªç»‘å®šç”¨æˆ·è´¦æˆ·",r.suggestions=["ä½¿ç”¨å·²ç»‘å®šçš„é’±åŒ…åœ°å€","è”ç³»å®¢æœç»‘å®šæ–°é’±åŒ…","æ£€æŸ¥é’±åŒ…åœ°å€æ˜¯å¦æ­£ç¡®"],r.canRetry=!1):(o.includes("insufficient")||o.includes("balance")||o.includes("gas"))&&(r.errorCode="INSUFFICIENT_BALANCE",r.errorType="BALANCE",r.userMessage="é’±åŒ…ä½™é¢ä¸è¶³ï¼Œæ— æ³•å®Œæˆæ“ä½œ",r.suggestions=["æ£€æŸ¥é’±åŒ…BNBä½™é¢","ç¡®ä¿æœ‰è¶³å¤Ÿçš„Gasè´¹ç”¨","å……å€¼åé‡è¯•"],r.canRetry=!0)}if(e.response){const o=e.response.status;switch(r.httpStatus=o,o){case 400:r.errorCode="BAD_REQUEST",r.userMessage="è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥";break;case 401:r.errorCode="UNAUTHORIZED",r.userMessage="æœªæˆæƒè®¿é—®ï¼Œè¯·é‡æ–°ç™»å½•";break;case 403:r.errorCode="FORBIDDEN",r.userMessage="æƒé™ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ";break;case 404:r.errorCode="NOT_FOUND",r.userMessage="è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨";break;case 429:r.errorCode="RATE_LIMITED",r.userMessage="è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•";break;case 500:r.errorCode="INTERNAL_SERVER_ERROR",r.userMessage="æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•";break;case 502:r.errorCode="BAD_GATEWAY",r.userMessage="ç½‘å…³é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•";break;case 503:r.errorCode="SERVICE_UNAVAILABLE",r.userMessage="æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•"}}return 0===r.suggestions.length&&(r.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥","é‡æ–°è¿æ¥é’±åŒ…","åˆ·æ–°é¡µé¢åé‡è¯•","è”ç³»æŠ€æœ¯æ”¯æŒ"]),this.logWalletLoginError(e,r,{walletAddress:o,chainId:t}),console.log("ğŸ“‹ é’±åŒ…ç™»å½•é”™è¯¯åˆ†æç»“æœ:",r),r}logWalletLoginError(e,o,t){const r={timestamp:Date.now(),errorType:"WALLET_LOGIN_ERROR",error:{message:e.message,stack:e.stack,name:e.name},errorInfo:o,context:t,userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",url:"undefined"!=typeof window?window.location.href:"unknown"};console.log("ğŸ“ é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—:",r);try{if("undefined"!=typeof window){const e=JSON.parse(localStorage.getItem("wallet_login_error_logs")||"[]");e.push(r),e.length>20&&e.splice(0,e.length-20),localStorage.setItem("wallet_login_error_logs",JSON.stringify(e)),console.log("ğŸ’¾ é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨")}}catch(s){console.error("ä¿å­˜é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—å¤±è´¥:",s)}}triggerBindingStatusUpdate(e){const o=new CustomEvent("walletBindingStatusUpdated",{detail:{...e,timestamp:Date.now()}});window.dispatchEvent(o),console.log("è§¦å‘é’±åŒ…ç»‘å®šçŠ¶æ€æ›´æ–°äº‹ä»¶:",e)}triggerBindingError(e){const o=new CustomEvent("walletBindingError",{detail:{error:e.message||"é’±åŒ…ç»‘å®šæ£€æµ‹å¤±è´¥",timestamp:Date.now()}});window.dispatchEvent(o),console.log("è§¦å‘é’±åŒ…ç»‘å®šé”™è¯¯äº‹ä»¶:",e)}async manualCheckBinding(e,o){return console.log("æ‰‹åŠ¨æ£€æµ‹é’±åŒ…ç»‘å®šçŠ¶æ€:",e),this.clearLocalCache(),await this.checkWalletBindingStatus(e,o)}clearLocalCache(){if(console.log("ğŸ§¹ é’±åŒ…ç»‘å®šæœåŠ¡æ¸…é™¤æœ¬åœ°ç¼“å­˜çŠ¶æ€..."),"undefined"!=typeof window){const e=[];for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);o&&(o.includes("user")||o.includes("auth")||o.includes("login"))&&e.push(o)}e.forEach((e=>{localStorage.removeItem(e),console.log("ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜:",e)}));const o=[];for(let t=0;t<sessionStorage.length;t++){const e=sessionStorage.key(t);e&&(e.includes("user")||e.includes("auth")||e.includes("login"))&&o.push(e)}o.forEach((e=>{sessionStorage.removeItem(e),console.log("ğŸ—‘ï¸ æ¸…é™¤ä¼šè¯ç¼“å­˜:",e)}))}console.log("âœ… é’±åŒ…ç»‘å®šæœåŠ¡æœ¬åœ°ç¼“å­˜çŠ¶æ€æ¸…é™¤å®Œæˆ")}init(){return this.isInitialized||(this.isInitialized=!0,console.log("âœ… é’±åŒ…ç»‘å®šæ£€æµ‹æœåŠ¡åˆå§‹åŒ–æˆåŠŸ")),!0}setupDebugTools(){"undefined"!=typeof window&&(console.log("ğŸ”§ å¼€å‘ç¯å¢ƒ - é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—æŸ¥çœ‹å·¥å…·å·²å¯ç”¨"),console.log("ğŸ“‹ æŸ¥çœ‹é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—: window.viewWalletLoginErrorLogs()"),console.log("ğŸ—‘ï¸ æ¸…é™¤é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—: window.clearWalletLoginErrorLogs()"),window.viewWalletLoginErrorLogs=()=>{try{const e=JSON.parse(localStorage.getItem("wallet_login_error_logs")||"[]");console.log("ğŸ“‹ é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—:",e),0===e.length?console.log("âœ… æš‚æ— é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—"):(console.log(`ğŸ“Š å…± ${e.length} æ¡é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—`),e.forEach(((e,o)=>{console.log(`--- é”™è¯¯æ—¥å¿— ${o+1} ---`),console.log("æ—¶é—´:",new Date(e.timestamp).toLocaleString()),console.log("é”™è¯¯ç±»å‹:",e.errorInfo.errorType),console.log("é”™è¯¯ä»£ç :",e.errorInfo.errorCode),console.log("ç”¨æˆ·æ¶ˆæ¯:",e.errorInfo.userMessage),console.log("é”™è¯¯è¯¦æƒ…:",e.error.message),console.log("å»ºè®®:",e.errorInfo.suggestions),console.log("å¯é‡è¯•:",e.errorInfo.canRetry)})))}catch(e){console.error("æŸ¥çœ‹é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—å¤±è´¥:",e)}},window.clearWalletLoginErrorLogs=()=>{try{localStorage.removeItem("wallet_login_error_logs"),console.log("ğŸ—‘ï¸ é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—å·²æ¸…é™¤")}catch(e){console.error("æ¸…é™¤é’±åŒ…ç™»å½•é”™è¯¯æ—¥å¿—å¤±è´¥:",e)}},window.analyzeWalletLoginError=e=>{try{const o={message:e},t=this.analyzeWalletLoginError(o,"0x...",97);return console.log("ğŸ” é”™è¯¯åˆ†æç»“æœ:",t),t}catch(o){console.error("åˆ†æé”™è¯¯å¤±è´¥:",o)}})}},a="0xFb015C1e853a66a7713e7C750C2fc4451405601b",i="0xf6307065A593840680765889Fc16461bC7781231",c="0x75579C9FB3A30e7c3CaBB5c74E4A6c0DB1e2054d";const l=new class{constructor(){this.isInitialized=!1,this.setupEventListeners()}setupEventListeners(){window.addEventListener("walletAccountChanged",this.handleWalletChange.bind(this))}async handleWalletChange(e){console.log("æ£€æµ‹åˆ°é’±åŒ…å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–åˆçº¦:",e.detail),this.isInitialized=!1;try{await this.init(),console.log("âœ… åˆçº¦é‡æ–°åˆå§‹åŒ–æˆåŠŸ"),this.triggerWalletBindingCheck(e.detail),this.clearLocalCache()}catch(o){console.error("âŒ åˆçº¦é‡æ–°åˆå§‹åŒ–å¤±è´¥:",o)}}clearLocalCache(){if(console.log("ğŸ§¹ æ¸…é™¤æœ¬åœ°ç¼“å­˜çŠ¶æ€..."),"undefined"!=typeof window){const e=[];for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);o&&(o.includes("user")||o.includes("auth")||o.includes("login"))&&e.push(o)}e.forEach((e=>{localStorage.removeItem(e),console.log("ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜:",e)}));const o=[];for(let t=0;t<sessionStorage.length;t++){const e=sessionStorage.key(t);e&&(e.includes("user")||e.includes("auth")||e.includes("login"))&&o.push(e)}o.forEach((e=>{sessionStorage.removeItem(e),console.log("ğŸ—‘ï¸ æ¸…é™¤ä¼šè¯ç¼“å­˜:",e)}))}console.log("âœ… æœ¬åœ°ç¼“å­˜çŠ¶æ€æ¸…é™¤å®Œæˆ")}triggerWalletBindingCheck(e){const o=new CustomEvent("walletBindingCheck",{detail:{account:e.account,chainId:e.chainId,timestamp:Date.now(),source:"contractService"}});window.dispatchEvent(o),console.log("åˆçº¦æœåŠ¡è§¦å‘é’±åŒ…ç»‘å®šæ£€æµ‹äº‹ä»¶")}async init(){try{if(this.isInitialized)return!0;console.log("å¼€å§‹åˆå§‹åŒ–åˆçº¦æœåŠ¡...");if(!(await e.init()))throw new Error("Web3åˆå§‹åŒ–å¤±è´¥");if(!(await e.connectWallet()).success)throw new Error("é’±åŒ…è¿æ¥å¤±è´¥");return await e.loadContract(a,s.abi,"VGAUPlatformRecharge"),await e.loadContract(i,o,"USDTToken"),await e.loadContract(c,t.abi,"VGAUToken"),await n.init(),this.isInitialized=!0,console.log("âœ… åˆçº¦æœåŠ¡åˆå§‹åŒ–æˆåŠŸ"),!0}catch(r){throw console.error("âŒ åˆçº¦æœåŠ¡åˆå§‹åŒ–å¤±è´¥:",r),r}}async reinit(){return console.log("æ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–åˆçº¦æœåŠ¡..."),this.isInitialized=!1,await this.init()}async getUSDTBalance(o=null){try{this.isInitialized||await this.init();const t=o||e.currentAccount,r=await e.callContractMethod("USDTToken","balanceOf",t);return{raw:r,formatted:(r/Math.pow(10,18)).toFixed(2)}}catch(t){throw console.error("è·å–USDTä½™é¢å¤±è´¥:",t),t}}async getVGAUBalance(o=null){try{this.isInitialized||await this.init();const t=o||e.currentAccount,r=await e.callContractMethod("VGAUToken","balanceOf",t);return{raw:r,formatted:(r/Math.pow(10,18)).toFixed(2)}}catch(t){throw console.error("è·å–VGAUä½™é¢å¤±è´¥:",t),t}}async getUSDTAllowance(o=null,t=null){try{this.isInitialized||await this.init();const r=o||e.currentAccount,s=t||a,n=await e.callContractMethod("USDTToken","allowance",r,s);return{raw:n,formatted:n/Math.pow(10,18)}}catch(r){throw console.error("è·å–USDTæˆæƒé¢åº¦å¤±è´¥:",r),r}}async getVGAUAllowance(o=null,t=null){try{this.isInitialized||await this.init();const r=o||e.currentAccount,s=t||a,n=await e.callContractMethod("VGAUToken","allowance",r,s);return{raw:n,formatted:n/Math.pow(10,18)}}catch(r){throw console.error("è·å–VGAUæˆæƒé¢åº¦å¤±è´¥:",r),r}}async approveUSDT(o){try{this.isInitialized||await this.init();const t=e.web3.utils.toWei(o.toString(),"ether").toString();console.log("ğŸ” å¼€å§‹æˆæƒUSDT..."),console.log("æˆæƒé‡‘é¢:",o,"USDT"),console.log("æˆæƒé‡‘é¢(wei):",t);const r=await e.sendTransaction("USDTToken","approve",{from:e.currentAccount},a,t);return console.log("âœ… USDTæˆæƒæˆåŠŸ:",r.transactionHash),r}catch(t){throw console.error("âŒ USDTæˆæƒå¤±è´¥:",t),t}}async approveVGAU(o){try{this.isInitialized||await this.init(),console.log("ğŸ” å¼€å§‹æˆæƒVGAU..."),console.log("æˆæƒé‡‘é¢:",o,"VGAU");const t=await e.sendTransaction("VGAUToken","approve",{from:e.currentAccount},a,o.toString());return console.log("âœ… VGAUæˆæƒæˆåŠŸ:",t.transactionHash),t}catch(t){throw console.error("âŒ VGAUæˆæƒå¤±è´¥:",t),t}}async resetUSDTAllowance(){try{this.isInitialized||await this.init(),console.log("ğŸ”„ é‡ç½®USDTæˆæƒé¢åº¦ä¸º0...");const o=await e.sendTransaction("USDTToken","approve",{from:e.currentAccount},a,0);return console.log("âœ… USDTæˆæƒé¢åº¦é‡ç½®æˆåŠŸ:",o.transactionHash),o}catch(o){throw console.error("âŒ USDTæˆæƒé¢åº¦é‡ç½®å¤±è´¥:",o),o}}async resetVGAUAllowance(){try{this.isInitialized||await this.init(),console.log("ğŸ”„ é‡ç½®VGAUæˆæƒé¢åº¦ä¸º0..."),console.log("ğŸ” å¼€å§‹æ£€æŸ¥ç½‘ç»œçŠ¶æ€...");const o=await this.checkNetwork();if(console.log("ğŸ“‹ ç½‘ç»œçŠ¶æ€æ£€æŸ¥ç»“æœ:",o),!o.isSupported)throw console.error("âŒ ç½‘ç»œä¸æ”¯æŒ:",{currentChainId:o.chainId,supportedChainIds:o.supportedChainIds,isSupported:o.isSupported}),new Error(`å½“å‰ç½‘ç»œä¸æ”¯æŒï¼Œè¯·åˆ‡æ¢åˆ°BSCæµ‹è¯•ç½‘ã€‚å½“å‰é“¾ID: ${o.chainId}`);console.log("âœ… ç½‘ç»œçŠ¶æ€æ£€æŸ¥é€šè¿‡");const t=await e.sendTransaction("VGAUToken","approve",{from:e.currentAccount},a,0);return console.log("âœ… VGAUæˆæƒé¢åº¦é‡ç½®æˆåŠŸ:",t.transactionHash),t}catch(o){if(console.error("âŒ VGAUæˆæƒé¢åº¦é‡ç½®å¤±è´¥:",o),o.message&&o.message.includes("RPC endpoint returned HTTP client error")){const e=new Error("åŒºå—é“¾ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");throw e.originalError=o,e.errorType="RPC_ERROR",e.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","å°è¯•åˆ‡æ¢ç½‘ç»œï¼ˆ4G/5G/WiFiï¼‰","æ£€æŸ¥VPNè®¾ç½®","ç¨åé‡è¯•ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œæ‹¥å µï¼‰"],e}throw o}}async rechargeUSDT(o){try{this.isInitialized||await this.init();const t=e.web3.utils.toWei(o.toString(),"ether").toString();console.log("ğŸ’° å¼€å§‹USDTå……å€¼..."),console.log("å……å€¼é‡‘é¢:",o,"USDT"),console.log("å……å€¼é‡‘é¢(wei):",t);const r=await e.sendTransaction("VGAUPlatformRecharge","rechargeUSDT",{from:e.currentAccount},t);return console.log("âœ… USDTå……å€¼æˆåŠŸ:",r.transactionHash),r}catch(t){throw console.error("âŒ USDTå……å€¼å¤±è´¥:",t),t}}async rechargeVGAU(o){try{this.isInitialized||await this.init(),console.log("ğŸ’° å¼€å§‹VGAUå……å€¼..."),console.log("å……å€¼é‡‘é¢:",o,"VGAU");const t=await e.sendTransaction("VGAUPlatformRecharge","rechargeVGAU",{from:e.currentAccount},o.toString());return console.log("âœ… VGAUå……å€¼æˆåŠŸ:",t.transactionHash),t}catch(t){throw console.error("âŒ VGAUå……å€¼å¤±è´¥:",t),t}}async completeUSDTRecharge(e){try{console.log("ğŸš€ å¼€å§‹å®Œæ•´USDTå……å€¼æµç¨‹..."),console.log("ğŸ“± è®¾å¤‡ä¿¡æ¯:",{userAgent:navigator.userAgent,platform:navigator.platform,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}),console.log("ğŸ” æ­¥éª¤1: æ£€æŸ¥USDTæˆæƒé¢åº¦...");const o=await this.getUSDTAllowance(),t=parseFloat(o.formatted),r=parseFloat(e);console.log("ğŸ“Š æˆæƒé¢åº¦æ£€æŸ¥:",{"å½“å‰æˆæƒé¢åº¦":t,"éœ€è¦æˆæƒé¢åº¦":r,"åŸå§‹æˆæƒé¢åº¦":o.raw,"æ˜¯å¦éœ€è¦æˆæƒ":t!==r}),t===r?console.log("âœ… USDTæˆæƒé¢åº¦å·²è¶³å¤Ÿï¼Œæ— éœ€é‡å¤æˆæƒ"):t>0?(console.log("ğŸ”„ é‡ç½®USDTæˆæƒé¢åº¦ä¸º0..."),console.log("â³ ç­‰å¾…é‡ç½®äº¤æ˜“ç¡®è®¤..."),await this.resetUSDTAllowance(),await this.waitForTransaction(),console.log("âœ… é‡ç½®äº¤æ˜“ç¡®è®¤å®Œæˆ"),console.log("ğŸ”„ é‡æ–°æˆæƒUSDT..."),await this.approveUSDT(e),console.log("â³ ç­‰å¾…æˆæƒäº¤æ˜“ç¡®è®¤..."),await this.waitForTransaction(),console.log("âœ… æˆæƒäº¤æ˜“ç¡®è®¤å®Œæˆ")):(console.log("ğŸ†• é¦–æ¬¡æˆæƒUSDT..."),await this.approveUSDT(e),console.log("â³ ç­‰å¾…æˆæƒäº¤æ˜“ç¡®è®¤..."),await this.waitForTransaction(),console.log("âœ… æˆæƒäº¤æ˜“ç¡®è®¤å®Œæˆ")),console.log("ğŸ” æ­¥éª¤3: æ‰§è¡ŒUSDTå……å€¼...");const s=await this.rechargeUSDT(e);return console.log("ğŸ‰ USDTå……å€¼æµç¨‹å®Œæˆ!"),s}catch(o){if(console.error("âŒ USDTå……å€¼æµç¨‹å¤±è´¥:",{error:o.message,stack:o.stack,errorType:o.errorType,suggestions:o.suggestions,contractName:o.contractName,methodName:o.methodName,timestamp:o.timestamp}),o.errorType)throw o;const e=new Error(`USDTå……å€¼å¤±è´¥: ${o.message}`);throw e.originalError=o,e.errorType="RECHARGE_ERROR",e.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","ç¡®ä¿é’±åŒ…å·²è¿æ¥å¹¶è§£é”","æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³","å°è¯•å‡å°‘å……å€¼é‡‘é¢","è”ç³»æŠ€æœ¯æ”¯æŒ"],e}}async completeVGAURecharge(e){try{console.log("ğŸš€ å¼€å§‹å®Œæ•´VGAUå……å€¼æµç¨‹..."),console.log("ğŸ“± è®¾å¤‡ä¿¡æ¯:",{userAgent:navigator.userAgent,platform:navigator.platform,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}),console.log("ğŸ” æ­¥éª¤1: æ£€æŸ¥VGAUæˆæƒé¢åº¦...");const o=await this.getVGAUAllowance(),t=parseFloat(o.formatted),r=parseFloat(e);console.log("ğŸ“Š æˆæƒé¢åº¦æ£€æŸ¥:",{"å½“å‰æˆæƒé¢åº¦":t,"éœ€è¦æˆæƒé¢åº¦":r,"åŸå§‹æˆæƒé¢åº¦":o.raw,"æ˜¯å¦éœ€è¦æˆæƒ":t!==r}),t===r?console.log("âœ… VGAUæˆæƒé¢åº¦å·²è¶³å¤Ÿï¼Œæ— éœ€é‡å¤æˆæƒ"):t>0?(console.log("ğŸ”„ é‡ç½®VGAUæˆæƒé¢åº¦ä¸º0..."),console.log("â³ ç­‰å¾…é‡ç½®äº¤æ˜“ç¡®è®¤..."),await this.resetVGAUAllowance(),await this.waitForTransaction(),console.log("âœ… é‡ç½®äº¤æ˜“ç¡®è®¤å®Œæˆ"),console.log("ğŸ”„ é‡æ–°æˆæƒVGAU..."),await this.approveVGAU(e),console.log("â³ ç­‰å¾…æˆæƒäº¤æ˜“ç¡®è®¤..."),await this.waitForTransaction(),console.log("âœ… æˆæƒäº¤æ˜“ç¡®è®¤å®Œæˆ")):(console.log("ğŸ†• é¦–æ¬¡æˆæƒVGAU..."),await this.approveVGAU(e),console.log("â³ ç­‰å¾…æˆæƒäº¤æ˜“ç¡®è®¤..."),await this.waitForTransaction(),console.log("âœ… æˆæƒäº¤æ˜“ç¡®è®¤å®Œæˆ")),console.log("ğŸ” æ­¥éª¤3: æ‰§è¡ŒVGAUå……å€¼...");const s=await this.rechargeVGAU(e);return console.log("ğŸ‰ VGAUå……å€¼æµç¨‹å®Œæˆ!"),s}catch(o){if(console.error("âŒ VGAUå……å€¼æµç¨‹å¤±è´¥:",{error:o.message,stack:o.stack,errorType:o.errorType,suggestions:o.suggestions,contractName:o.contractName,methodName:o.methodName,timestamp:o.timestamp}),o.errorType)throw o;const e=new Error(`VGAUå……å€¼å¤±è´¥: ${o.message}`);throw e.originalError=o,e.errorType="RECHARGE_ERROR",e.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","ç¡®ä¿é’±åŒ…å·²è¿æ¥å¹¶è§£é”","æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³","å°è¯•å‡å°‘å……å€¼é‡‘é¢","è”ç³»æŠ€æœ¯æ”¯æŒ"],e}}async waitForTransaction(){return new Promise((e=>{setTimeout(e,3e3)}))}async getNetworkInfo(){try{return await e.getNetworkInfo()}catch(o){throw console.error("è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥:",o),o}}async checkNetwork(){try{console.log("ğŸ” ContractService.checkNetwork å¼€å§‹..."),console.log("ğŸ“‹ è°ƒç”¨ web3Service.checkNetwork([97])");const o=await e.checkNetwork([97]);return console.log("ğŸ“‹ web3Service.checkNetwork è¿”å›ç»“æœ:",o),console.log("ğŸ“‹ ç»“æœç±»å‹æ£€æŸ¥:",{chainId:o.chainId,chainIdType:typeof o.chainId,isSupported:o.isSupported,isSupportedType:typeof o.isSupported,supportedChainIds:o.supportedChainIds}),o}catch(o){throw console.error("âŒ ContractService.checkNetwork å¤±è´¥:",o),o}}};export{l as c};
