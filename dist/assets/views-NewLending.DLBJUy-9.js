import{_ as e,u as a,r as l,K as t,o as n,d as s,w as o,v as i,i as u,e as c,f as d,h as r,j as f,k as m,t as v,l as p,I as _,n as g,M as F,D as L,z as b,A as h}from"./index-BYz-dWzL.js";import{_ as R}from"./back.BFYz81iB.js";import{_ as w}from"./history.BXkQwhl1.js";import{u as A,l as x}from"./apiService.Bl7qyh6B.js";const y=e({__name:"NewLending",setup(e){const{t:y}=a(),V=l(""),U=l(""),k=l("0"),N=l(!1),G=l({maxLtvRatio:"78%",riskThresholdLevel2:"88%",riskThresholdLiquidation:"85%",insuranceFeeRate:"2%",annualRate:"8.18%"}),T=l(!1),S=t((()=>{if(!V.value||isNaN(V.value))return"";return(.8*parseFloat(V.value)).toFixed(2)})),$=e=>{if(null==e)return 0;if("number"==typeof e)return e>1?e/100:e;const a=String(e).trim();if(a.endsWith("%")){const e=parseFloat(a.slice(0,-1));return isNaN(e)?0:e/100}const l=parseFloat(a);return isNaN(l)?0:l>1?l/100:l},j=e=>{if(null==e)return"--";if("number"==typeof e){return`${parseFloat((100*e).toFixed(2))}%`}const a=String(e).trim();if(a.endsWith("%"))return a;const l=parseFloat(a);if(isNaN(l))return"--";return`${parseFloat((100*l).toFixed(2))}%`},q=e=>("string"==typeof e&&(e=parseFloat(e)),isNaN(e)?"0":e>=1e3?e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}):e.toFixed(2)),C=()=>{k.value&&"0"!==k.value?(V.value=k.value.replace(/,/g,""),V.value&&!isNaN(V.value)&&(U.value=S.value)):i({title:"请先获取余额信息",icon:"none",duration:2e3})},I=()=>{L({url:"/views/InfoPage"})},D=async()=>{if(!V.value||parseFloat(V.value)<=0)i({title:y("common.pleaseEnterValidAmount"),icon:"none",duration:2e3});else if(!U.value||parseFloat(U.value)<=0)i({title:y("components.newLending.pleaseEnterBorrowAmount"),icon:"none",duration:2e3});else try{b({title:"提交中..."});const e=parseFloat(String(V.value).replace(/,/g,"")),a=parseFloat(String(U.value).replace(/,/g,"")),l=$(G.value.insuranceFeeRate),t=$(G.value.annualRate);console.log("🔍 保险费率解析详情:",{"原始值":G.value.insuranceFeeRate,"解析后小数":l,"解析函数":"parsePercentToDecimal"});const n={collateralAmount:e,loanAmount:a,expectedInsuranceFeeRate:l,expectedAnnualRate:t};console.log("📝 创建借贷订单参数:",n),console.log("🔍 参数详情:",{collateralAmount:`${e} VGAU`,loanAmount:`${a} USDT`,expectedInsuranceFeeRate:`${l} (保险费率: ${G.value.insuranceFeeRate})`,expectedAnnualRate:`${t} (${G.value.annualRate})`});const s=await x.createOrder(n);console.log("✅ 创建借贷订单响应:",s),s&&s.success?i({title:"创建成功",icon:"success",duration:1500}):i({title:(null==s?void 0:s.message)||"创建失败",icon:"none",duration:2e3})}catch(e){console.error("❌ 创建借贷订单异常:",e),i({title:"创建失败，请稍后重试",icon:"none",duration:2e3})}finally{h()}},E=()=>{F()};return n((()=>{console.log("🚀 NewLending页面加载完成，开始获取数据..."),(async()=>{var e,a,l;try{N.value=!0,console.log("📡 开始获取用户VGAU余额...");const t=await A.getBalances();if(console.log("📡 VGAU余额接口响应:",t),console.log("🔍 响应数据结构:",{success:null==t?void 0:t.success,message:null==t?void 0:t.message,dataLength:null==(e=null==t?void 0:t.data)?void 0:e.length,dataKeys:(null==(a=null==t?void 0:t.data)?void 0:a[0])?Object.keys(t.data[0]):[],firstItem:null==(l=null==t?void 0:t.data)?void 0:l[0]}),t&&t.success&&t.data){const e=t.data.find((e=>e.currency&&"VGAU"===e.currency.toUpperCase()));console.log("🔍 找到的VGAU数据:",e),e&&void 0!==e.availableAmount?(k.value=q(e.availableAmount),console.log("✅ VGAU余额获取成功:",k.value)):(console.warn("⚠️ 未找到VGAU余额数据或availableAmount字段"),console.log("🔍 VGAU数据详情:",e),k.value="0")}else console.warn("⚠️ VGAU余额接口返回异常:",t),k.value="0"}catch(t){console.error("❌ 获取VGAU余额失败:",t),k.value="0",i({title:"获取余额失败，请稍后重试",icon:"none",duration:2e3})}finally{N.value=!1}})(),(async()=>{try{T.value=!0,console.log("📡 开始获取借贷配置...");const e=await x.getConfig();console.log("📡 借贷配置接口响应:",e),e&&e.success&&e.data?(G.value={maxLtvRatio:j(e.data.maxLtvRatio)||"78%",riskThresholdLevel2:j(e.data.riskThresholdLevel2)||"88%",riskThresholdLiquidation:j(e.data.riskThresholdLiquidation)||"85%",insuranceFeeRate:e.data.insuranceFeeRate||"0.0200",annualRate:j(e.data.annualRate)||"8.18%"},console.log("✅ 借贷配置获取成功:",G.value),console.log("🔍 保险费率详情:",{"原始值":e.data.insuranceFeeRate,"处理后值":G.value.insuranceFeeRate,"转换后小数":$(G.value.insuranceFeeRate)})):console.warn("⚠️ 借贷配置接口返回异常:",e)}catch(e){console.error("❌ 获取借贷配置失败:",e)}finally{T.value=!1}})()})),(e,a)=>{const l=r,t=u,n=f,i=_;return c(),s(t,{class:"content"},{default:o((()=>[d(t,{class:"header"},{default:o((()=>[d(t,{class:"back-button",onClick:E},{default:o((()=>[d(l,{class:"back-icon",src:R,mode:"aspectFit"})])),_:1}),d(t,{class:"page-title"},{default:o((()=>[d(n,{class:"title-text"},{default:o((()=>[m(v(p(y)("components.newLending.lending")),1)])),_:1})])),_:1}),d(t,{class:"history-button"},{default:o((()=>[d(l,{class:"history-icon",src:w,mode:"aspectFit"})])),_:1})])),_:1}),d(t,{class:"main-content"},{default:o((()=>[d(t,{class:"notice-section"},{default:o((()=>[d(t,{class:"notice-content"},{default:o((()=>[d(t,{class:"info-button",onClick:I},{default:o((()=>[d(n,{class:"info-icon"},{default:o((()=>[m("!")])),_:1})])),_:1}),d(n,{class:"notice-text"},{default:o((()=>[m(v(p(y)("components.newLending.pledgedVGAUAssets")),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"parameters-section"},{default:o((()=>[d(t,{class:"parameter-item"},{default:o((()=>[d(n,{class:"parameter-label"},{default:o((()=>[m(v(p(y)("components.newLending.collateralQuantity")),1)])),_:1}),d(t,{class:"input-container"},{default:o((()=>[d(i,{class:"amount-input",type:"number",placeholder:"Enter amount",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),"adjust-position":!1},null,8,["modelValue"]),m("qian "),d(t,{class:"input-suffix"},{default:o((()=>[d(n,{class:"currency-text"},{default:o((()=>[m("VGAU")])),_:1}),d(t,{class:"divider"}),d(n,{class:"max-text",onClick:C},{default:o((()=>[m(v(p(y)("components.newLending.max")),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"available-balance"},{default:o((()=>[d(n,{class:"balance-label"},{default:o((()=>[m(v(p(y)("components.newLending.availableAssets")),1)])),_:1}),d(n,{class:g(["balance-amount",{loading:N.value}])},{default:o((()=>[m(v(N.value?"加载中...":`${k.value} VGAU`),1)])),_:1},8,["class"])])),_:1})])),_:1}),d(t,{class:"parameter-item"},{default:o((()=>[d(n,{class:"parameter-label"},{default:o((()=>[m(v(p(y)("components.newLending.availableToBorrow")),1)])),_:1}),d(t,{class:"input-container"},{default:o((()=>[d(i,{class:"amount-input",type:"number",placeholder:"Enter amount",modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value=e),"adjust-position":!1},null,8,["modelValue"]),d(t,{class:"input-suffix"},{default:o((()=>[d(n,{class:"currency-text-white"},{default:o((()=>[m("USDT")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"details-section"},{default:o((()=>[d(t,{class:"details-part"},{default:o((()=>[d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.liquidationInsuranceFee")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m(v(j(G.value.insuranceFeeRate)),1)])),_:1})])),_:1}),d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.initialCollateralRatio")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m(v(G.value.maxLtvRatio),1)])),_:1})])),_:1}),d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.additionalMargin")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m(v(G.value.riskThresholdLevel2),1)])),_:1})])),_:1}),d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.forcedLiquidationCollateralRatio")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m(v(G.value.riskThresholdLiquidation),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"divider-line"}),d(t,{class:"details-part"},{default:o((()=>[d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.annualInterestRate")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m(v(G.value.annualRate),1)])),_:1})])),_:1}),d(t,{class:"detail-item"},{default:o((()=>[d(n,{class:"detail-label"},{default:o((()=>[m(v(p(y)("components.newLending.liquidationReferencePrice")),1)])),_:1}),d(n,{class:"detail-value"},{default:o((()=>[m("0 兑")])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"confirm-section"},{default:o((()=>[d(t,{class:"confirm-btn",onClick:D},{default:o((()=>[d(n,{class:"confirm-text"},{default:o((()=>[m(v(p(y)("components.newLending.confirmLending")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-685dabfc"]]);export{y as default};
