import{_ as e,u as a,r as s,N as l,o as t,d as r,w as c,i as o,e as n,f as u,g as d,O as i,h as m,j as f,k as v,t as _,l as p,I as g,n as h,s as y,P as b,M as x,v as k,z as T,A as U,y as C}from"./index-BYz-dWzL.js";import{_ as w}from"./back.BFYz81iB.js";import{c as E}from"./contractExchange.Ckv1YkvP.js";import"./BEP20USDT.4l3CktaQ.js";const R=e({__name:"Redeem",setup(e){const{t:R}=a(),D=s(""),V=s(!1),j=s(!1),F=s(120),S=s(!1),z=s({title:"",message:"",confirmText:""}),A=s("0"),G=()=>{var e;try{return((null==(e=C.global.locale)?void 0:e.value)||"en").startsWith("zh")?"正在贖回...":"Redeeming..."}catch(a){return"Redeeming..."}},P=()=>{var e;try{return((null==(e=C.global.locale)?void 0:e.value)||"en").startsWith("zh")?"錯誤":"Error"}catch(a){return"Error"}},q=()=>{var e;try{return((null==(e=C.global.locale)?void 0:e.value)||"en").startsWith("zh")?"確認":"Confirm"}catch(a){return"Confirm"}},I=e=>{var a;try{const s=((null==(a=C.global.locale)?void 0:a.value)||"en").startsWith("zh");if("KYC_REQUIRED"===e.errorType)return e.message;if(e.message){if(e.message.includes("余额不足")||e.message.includes("Insufficient balance"))return e.message;if(e.message.includes("用户取消")||e.message.includes("User rejected"))return s?"用戶取消操作":"User Cancelled Operation";if(e.message.includes("网络")||e.message.includes("network"))return s?"網絡錯誤":"Network Error";if(e.message.includes("Gas")||e.message.includes("gas"))return s?"Gas費用不足":"Insufficient Gas Fee"}return s?"贖回失敗":"Redeem Failed"}catch(s){return"Redeem Failed"}},W=()=>{var e;try{return((null==(e=C.global.locale)?void 0:e.value)||"en").startsWith("zh")?"請輸入有效金額":"Please Enter Valid Amount"}catch(a){return"Please Enter Valid Amount"}},N=async()=>{if(!D.value||parseFloat(D.value)<=0)k({title:W(),icon:"none",duration:2e3});else if(!j.value)try{j.value=!0,T({title:G(),mask:!0}),console.log("🚀 开始VGAU赎回USDT流程..."),console.log("赎回数量:",D.value,"VGAU");const e=await E.exchangeVgauToUsdt(D.value);U(),console.log("✅ 赎回成功:",e),V.value=!0}catch(e){console.error("❌ 赎回失败:",e),U(),z.value={title:P(),message:I(e),confirmText:q()},S.value=!0}finally{j.value=!1}},M=()=>{x()},O=()=>{V.value=!1,D.value=""},B=()=>{S.value=!1};return l(D,(()=>{(async()=>{if(D.value&&!isNaN(D.value))try{const e=parseFloat(D.value);console.log("🔍 计算赎回USDT:",e);const a=await E.getRequiredUSDT(e);console.log("📊 计算结果:",a),A.value=a.formatted.toFixed(2)}catch(e){console.error("计算所需USDT失败:",e),A.value="0"}else A.value="0"})()}),{immediate:!1}),t((async()=>{try{await(async()=>{try{const e=await E.getLatestGoldPrice();F.value=parseFloat(e)/Math.pow(10,8),console.log("获取到最新黄金价格:",F.value)}catch(e){console.error("获取价格失败:",e),F.value=120}})()}catch(e){console.error("初始化价格失败:",e)}})),(e,a)=>{const s=m,l=o,t=f,x=g;return n(),r(l,{class:"redeem-container"},{default:c((()=>[u(l,{class:"page-header"},{default:c((()=>[u(l,{class:"back-button",onClick:M},{default:c((()=>[u(l,{class:"back-icon"},{default:c((()=>[u(s,{src:w,class:"back-arrow"})])),_:1})])),_:1}),u(t,{class:"title-text"},{default:c((()=>[v(_(p(R)("components.redeem.title")),1)])),_:1})])),_:1}),u(l,{class:"brand-section"},{default:c((()=>[u(l,{class:"brand-info"},{default:c((()=>[u(t,{class:"brand-title"},{default:c((()=>[v(_(p(R)("components.redeem.brandTitle")),1)])),_:1}),u(t,{class:"brand-subtitle"},{default:c((()=>[v(_(p(R)("components.redeem.brandSubtitle")),1)])),_:1}),u(t,{class:"brand-description"},{default:c((()=>[v(_(p(R)("components.redeem.brandDescription")),1)])),_:1})])),_:1}),u(l,{class:"rate-info"},{default:c((()=>[u(l,{class:"rate-info-content"},{default:c((()=>[u(t,{class:"rate-text"},{default:c((()=>[v(_(p(R)("components.redeem.rateText")),1)])),_:1})])),_:1}),u(l,{class:"divider-line"})])),_:1})])),_:1}),u(l,{class:"redeem-section"},{default:c((()=>[u(l,{class:"currency-selector"},{default:c((()=>[u(t,{class:"currency-text"},{default:c((()=>[v(_(p(R)("components.redeem.currency1")),1)])),_:1}),u(l,{class:"exchange-icon"},{default:c((()=>[u(t,{class:"arrow-icon"},{default:c((()=>[v("→")])),_:1})])),_:1}),u(t,{class:"currency-text"},{default:c((()=>[v(_(p(R)("components.redeem.currency2")),1)])),_:1})])),_:1}),u(l,{class:"input-container"},{default:c((()=>[u(l,{class:"input-field"},{default:c((()=>[u(x,{class:"input-text",type:"number",modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),placeholder:p(R)("components.redeem.redeemAmountPlaceholder"),"placeholder-class":"placeholder-text","adjust-position":!1,"hold-keyboard":!0,"cursor-spacing":200},null,8,["modelValue","placeholder"]),u(t,{class:"currency-label"},{default:c((()=>[v(_(p(R)("components.redeem.currency1")),1)])),_:1})])),_:1})])),_:1}),u(l,{class:"required-info"},{default:c((()=>[u(t,{class:"required-label"},{default:c((()=>[v(_(p(R)("components.redeem.requiredUSDT")),1)])),_:1}),u(t,{class:"required-value"},{default:c((()=>[v(_(A.value),1)])),_:1})])),_:1})])),_:1}),u(l,{class:h(["confirm-btn",{loading:j.value}]),onClick:N},{default:c((()=>[u(t,{class:"confirm-text"},{default:c((()=>[v(_(j.value?G():p(R)("components.redeem.confirmRedeem")),1)])),_:1})])),_:1},8,["class"]),S.value?(n(),r(l,{key:0,class:"custom-error-modal",onClick:B},{default:c((()=>[u(l,{class:"error-modal-content",onClick:a[1]||(a[1]=y((()=>{}),["stop"]))},{default:c((()=>[u(l,{class:"error-header"},{default:c((()=>[u(t,{class:"error-title"},{default:c((()=>[v(_(z.value.title),1)])),_:1})])),_:1}),u(l,{class:"error-body"},{default:c((()=>[u(t,{class:"error-message"},{default:c((()=>[v(_(z.value.message),1)])),_:1})])),_:1}),u(l,{class:"error-footer"},{default:c((()=>[u(l,{class:"error-confirm-btn",onClick:B},{default:c((()=>[u(t,{class:"error-confirm-text"},{default:c((()=>[v(_(z.value.confirmText),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0),i(u(l,{class:"modal-overlay",onClick:O},{default:c((()=>[u(l,{class:"success-modal",onClick:a[2]||(a[2]=y((()=>{}),["stop"]))},{default:c((()=>[u(l,{class:"success-content"},{default:c((()=>[u(t,{class:"success-text"},{default:c((()=>[v(_(p(R)("components.redeem.successText")),1)])),_:1}),u(t,{class:"success-value"},{default:c((()=>[v(_(D.value)+" "+_(p(R)("components.redeem.currency1")),1)])),_:1})])),_:1}),u(l,{class:"complete-btn",onClick:O},{default:c((()=>[u(t,{class:"complete-text"},{default:c((()=>[v(_(p(R)("components.redeem.completeText")),1)])),_:1})])),_:1})])),_:1})])),_:1},512),[[b,V.value]])])),_:1})}}},[["__scopeId","data-v-96cc176d"]]);export{R as default};
