import{_ as e,u as a,r as t,K as s,o as l,d as u,w as c,v as o,i as n,e as r,f as d,h as i,j as m,k as p,t as f,l as _,g as v,m as h,F as P,p as g,n as b,I as y,M as A,D as k,z as x,A as C}from"./index-BYz-dWzL.js";import{_ as V}from"./back.BFYz81iB.js";import{_ as w}from"./history.BXkQwhl1.js";import{_ as R}from"./xiangqing.B-qAyJFN.js";import{s as F,u as I}from"./apiService.Bl7qyh6B.js";const $=e({__name:"ProductPurchase",setup(e){const{t:$}=a(),D=t([]),U=t(!1),G=t(""),S=t(!1),M=t(""),T=t("transaction"),j=t("0.00"),E=t(!1),B=s((()=>D.value.find((e=>e.id===G.value)))),q=async()=>{try{E.value=!0,console.log("🔄 开始获取VGAU余额...");const e=await I.getBalances();if(console.log("✅ VGAU余额获取成功:",e),e.success&&e.data){const a=e.data.find((e=>"VGAU"===e.currency));a?(j.value=a.availableAmount||"0.00",console.log("💰 VGAU余额设置成功:",j.value)):(console.log("⚠️ 未找到VGAU余额数据"),j.value="0.00")}else console.log("⚠️ 获取余额失败，使用默认值"),j.value="0.00"}catch(e){console.error("❌ 获取VGAU余额失败:",e),j.value="0.00",o({title:"余额获取失败",icon:"none",duration:2e3})}finally{E.value=!1}},O=async()=>{try{U.value=!0,console.log("🔄 开始获取质押产品列表...");const e=await F.getProducts();if(console.log("✅ 质押产品列表获取成功:",e),!e.success||!e.data)throw new Error(e.message||"获取产品列表失败");D.value=e.data,D.value.length>0&&(G.value=D.value[0].id)}catch(e){console.error("❌ 获取质押产品列表失败:",e),o({title:e.message||$("common.networkError"),icon:"none",duration:3e3}),D.value=[{id:"mock_7d",name:"7天短期质押",description:"7天短期质押产品，年化收益5.5%",annualRate:"5.50",lockDays:7,minAmount:100,maxAmount:1e4,status:"ACTIVE"},{id:"mock_30d",name:"30天中期质押",description:"30天中期质押产品，年化收益8.0%",annualRate:"8.00",lockDays:30,minAmount:500,maxAmount:5e4,status:"ACTIVE"}],D.value.length>0&&(G.value=D.value[0].id)}finally{U.value=!1}},z=()=>{S.value=!1},H=()=>{if(B.value){const e=B.value.maxAmount,a=parseFloat(j.value)||0,t=Math.min(e,a);M.value=t.toString(),console.log("💰 设置最大金额:",{productMaxAmount:e,userBalance:a,finalMaxAmount:t})}else{const e=parseFloat(j.value)||0;M.value=e.toString()}},K=e=>{T.value=e},L=()=>{o({title:$("components.productPurchase.recordsFeature"),icon:"none",duration:2e3})},N=()=>{k({url:"/views/ProductHelp"})},Y=async()=>{if(!B.value)return void o({title:$("components.productPurchase.selectProduct"),icon:"none",duration:2e3});if(!M.value||parseFloat(M.value)<=0)return void o({title:$("common.pleaseEnterValidAmount"),icon:"none",duration:2e3});const e=parseFloat(M.value),a=B.value.minAmount,t=B.value.maxAmount;if(e<a||e>t)return void o({title:`${$("components.productPurchase.amountOutOfRange")} (${a}-${t} VGAU)`,icon:"none",duration:3e3});const s=parseFloat(j.value)||0;e>s?o({title:`余额不足，当前可用余额: ${s} VGAU`,icon:"none",duration:3e3}):await J()},J=async()=>{try{x({title:$("components.productPurchase.processing"),mask:!0}),console.log("🔄 开始创建质押订单...",{productId:B.value.id,stakeAmount:parseInt(M.value)});const e={productId:B.value.id,stakeAmount:parseInt(M.value)},a=await F.createOrder(e);console.log("📡 质押订单创建API响应:",a),console.log("📊 响应结构分析:",{hasSuccess:!!a.success,successValue:a.success,hasCode:!!a.code,codeValue:a.code,hasStatusCode:!!a.statusCode,statusCodeValue:a.statusCode,hasData:!!a.data,hasMessage:!!a.message,messageValue:a.message}),C();const t=a.success||0===a.code||200===a.statusCode,s=(a.data,a.message||"质押订单创建成功");if(console.log("🔍 成功判断结果:",{isSuccess:t,success:a.success,code:a.code,statusCode:a.statusCode}),!t)throw new Error(s||"创建订单失败");o({title:s,icon:"success",duration:1e3}),M.value="",S.value=!1,await q(),setTimeout((()=>{A()}),1e3)}catch(e){console.error("❌ 创建质押订单失败:",e),C();let a=$("components.productPurchase.orderCreateFailed");if(e.message){if(e.message.includes("质押订单创建成功")||e.message.includes("success"))return console.log("⚠️ API实际成功，但响应结构有问题，按成功处理"),o({title:$("components.productPurchase.orderCreateSuccess"),icon:"success",duration:1e3}),M.value="",S.value=!1,await q(),void setTimeout((()=>{A()}),1e3);a=e.message.includes("余额不足")||e.message.includes("insufficient")?$("common.insufficientBalance"):e.message.includes("产品不存在")||e.message.includes("product not found")?$("components.productPurchase.productNotFound"):e.message.includes("金额")||e.message.includes("amount")?$("components.productPurchase.invalidAmount"):e.message}o({title:a,icon:"none",duration:4e3})}},Q=()=>{A()};return l((async()=>{console.log("📱 ProductPurchase 页面初始化开始..."),await Promise.all([O(),q()]),console.log("✅ ProductPurchase 页面初始化完成")})),(e,a)=>{const t=i,s=n,l=m,o=y;return r(),u(s,{class:"content"},{default:c((()=>[d(s,{class:"header"},{default:c((()=>[d(s,{class:"back-button",onClick:Q},{default:c((()=>[d(t,{class:"back-icon",src:V,mode:"aspectFit"})])),_:1}),d(s,{class:"page-title"},{default:c((()=>[d(l,{class:"title-text"},{default:c((()=>[p(f(_($)("components.productPurchase.productPurchase")),1)])),_:1})])),_:1}),d(s,{class:"header-buttons"},{default:c((()=>[d(s,{class:"header-button",onClick:L},{default:c((()=>[d(t,{class:"header-icon",src:w,mode:"aspectFit"})])),_:1}),d(s,{class:"header-button",onClick:N},{default:c((()=>[d(t,{class:"header-icon",src:R,mode:"aspectFit"})])),_:1})])),_:1})])),_:1}),d(s,{class:"main-content"},{default:c((()=>[d(s,{class:"content-area"},{default:c((()=>[d(s,{class:"product-selection"},{default:c((()=>[(r(!0),h(P,null,g(D.value,(a=>(r(),u(s,{key:a.id,class:b(["product-card",{active:G.value===a.id}]),onClick:e=>{return t=a.id,G.value=t,void(S.value=!0);var t}},{default:c((()=>[d(l,{class:"product-term"},{default:c((()=>[p(f(a.lockDays)+f(e.$t("stakingDetail.days")),1)])),_:2},1024),d(l,{class:"product-apy"},{default:c((()=>[p(f(a.annualRate)+"% APY",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128)),U.value?(r(),u(s,{key:0,class:"loading-card"},{default:c((()=>[d(l,{class:"loading-text"},{default:c((()=>[p(f(e.$t("common.loading")),1)])),_:1})])),_:1})):v("",!0),U.value||0!==D.value.length?v("",!0):(r(),u(s,{key:1,class:"empty-card"},{default:c((()=>[d(l,{class:"empty-text"},{default:c((()=>[p(f(e.$t("common.noData")),1)])),_:1})])),_:1}))])),_:1}),S.value&&B.value?(r(),u(s,{key:0,class:"product-detail-bar"},{default:c((()=>[d(s,{class:"detail-header"},{default:c((()=>[d(l,{class:"detail-title"},{default:c((()=>[p(f(e.$t("components.productPurchase.productDetails"))+" - "+f(B.value.name),1)])),_:1}),d(s,{class:"close-button",onClick:z},{default:c((()=>[d(l,{class:"close-text"},{default:c((()=>[p("×")])),_:1})])),_:1})])),_:1}),d(s,{class:"detail-content"},{default:c((()=>[d(s,{class:"detail-item"},{default:c((()=>[d(l,{class:"detail-label"},{default:c((()=>[p(f(e.$t("components.productPurchase.term"))+":",1)])),_:1}),d(l,{class:"detail-value"},{default:c((()=>[p(f(B.value.lockDays)+f(e.$t("stakingDetail.days")),1)])),_:1})])),_:1}),d(s,{class:"detail-item"},{default:c((()=>[d(l,{class:"detail-label"},{default:c((()=>[p(f(e.$t("components.productPurchase.apy"))+":",1)])),_:1}),d(l,{class:"detail-value"},{default:c((()=>[p(f(B.value.annualRate)+"%",1)])),_:1})])),_:1}),d(s,{class:"detail-item"},{default:c((()=>[d(l,{class:"detail-label"},{default:c((()=>[p(f(e.$t("components.productPurchase.minAmount"))+":",1)])),_:1}),d(l,{class:"detail-value"},{default:c((()=>[p(f(B.value.minAmount)+" VGAU",1)])),_:1})])),_:1}),d(s,{class:"detail-item"},{default:c((()=>[d(l,{class:"detail-label"},{default:c((()=>[p(f(e.$t("components.productPurchase.maxAmount"))+":",1)])),_:1}),d(l,{class:"detail-value"},{default:c((()=>[p(f(B.value.maxAmount)+" VGAU",1)])),_:1})])),_:1})])),_:1})])),_:1})):v("",!0),d(s,{class:"amount-section"},{default:c((()=>[d(l,{class:"amount-label"},{default:c((()=>[p(f(_($)("components.productPurchase.amount")),1)])),_:1}),d(s,{class:"amount-input-container"},{default:c((()=>[d(o,{class:"amount-input",type:"number",placeholder:e.$t("components.productPurchase.enterStakingAmount"),modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),"adjust-position":!1},null,8,["placeholder","modelValue"]),d(s,{class:"input-suffix"},{default:c((()=>[d(l,{class:"currency-text"},{default:c((()=>[p(f(_($)("components.productPurchase.vgau")),1)])),_:1}),d(s,{class:"max-button",onClick:H},{default:c((()=>[d(l,{class:"max-text"},{default:c((()=>[p(f(_($)("components.productPurchase.max")),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"available-balance"},{default:c((()=>[p(f(_($)("components.productPurchase.availableBalance"))+" ",1),d(l,{class:"balance-amount"},{default:c((()=>[E.value?(r(),u(l,{key:0,class:"loading-text"},{default:c((()=>[p("加载中...")])),_:1})):(r(),u(l,{key:1},{default:c((()=>[p(f(j.value),1)])),_:1}))])),_:1}),p(" "+f(_($)("components.productPurchase.vgau")),1)])),_:1})])),_:1}),d(s,{class:b(["rules-section",{"product-rules-active":"product"===T.value}])},{default:c((()=>[d(s,{class:"rules-tabs"},{default:c((()=>[d(s,{class:b(["tab",{active:"transaction"===T.value}]),onClick:a[1]||(a[1]=e=>K("transaction"))},{default:c((()=>[d(l,{class:"tab-text"},{default:c((()=>[p(f(_($)("components.productPurchase.transactionRules")),1)])),_:1})])),_:1},8,["class"]),d(s,{class:b(["tab",{active:"product"===T.value}]),onClick:a[2]||(a[2]=e=>K("product"))},{default:c((()=>[d(l,{class:"tab-text"},{default:c((()=>[p(f(_($)("components.productPurchase.productRules")),1)])),_:1})])),_:1},8,["class"])])),_:1}),"transaction"===T.value?(r(),u(s,{key:0,class:"rules-content"},{default:c((()=>[d(s,{class:"transaction-rule-item"},{default:c((()=>[d(l,{class:"transaction-rule-label"},{default:c((()=>[p(f(_($)("components.productPurchase.purchaseTime")),1)])),_:1}),d(l,{class:"transaction-rule-value"},{default:c((()=>[p(f(_($)("components.productPurchase.purchaseTimeValue")),1)])),_:1})])),_:1}),d(s,{class:"transaction-rule-item"},{default:c((()=>[d(l,{class:"transaction-rule-label"},{default:c((()=>[p(f(_($)("components.productPurchase.expirationTime")),1)])),_:1}),d(l,{class:"transaction-rule-value"},{default:c((()=>[p(f(_($)("components.productPurchase.expirationTimeValue")),1)])),_:1})])),_:1}),d(s,{class:"transaction-rule-item"},{default:c((()=>[d(l,{class:"transaction-rule-label"},{default:c((()=>[p(f(_($)("components.productPurchase.estimatedInterest")),1)])),_:1}),d(l,{class:"transaction-rule-value"},{default:c((()=>[p(f(_($)("components.productPurchase.estimatedInterestValue")),1)])),_:1})])),_:1}),d(s,{class:"transaction-rule-item"},{default:c((()=>[d(l,{class:"transaction-rule-label"},{default:c((()=>[p(f(_($)("components.productPurchase.requiresManualRedemption")),1)])),_:1}),d(l,{class:"transaction-rule-value"},{default:c((()=>[p(f(_($)("components.productPurchase.requiresManualRedemptionValue")),1)])),_:1})])),_:1})])),_:1})):(r(),u(s,{key:1,class:"rules-content"},{default:c((()=>[d(s,{class:"rule-section"},{default:c((()=>[d(l,{class:"rule-section-title"},{default:c((()=>[p(f(_($)("components.productPurchase.rewards")),1)])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.rewardsDailyChange")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.rewardsStartCalculation")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.rewardsAfterStaking")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.settlementIncome")),1)])),_:1})])),_:1})])),_:1}),d(s,{class:"rule-section"},{default:c((()=>[d(l,{class:"rule-section-title"},{default:c((()=>[p(f(_($)("components.productPurchase.subscriptionAndRedemption")),1)])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.subscriptionAndRedemptionDaily")),1)])),_:1})])),_:1})])),_:1}),d(s,{class:"rule-section"},{default:c((()=>[d(l,{class:"rule-section-title"},{default:c((()=>[p(f(_($)("components.productPurchase.earlyRedemption")),1)])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.earlyRedemptionMyFinance")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.earlyRedemptionLoseIncome")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.earlyRedemptionBalanceCredit")),1)])),_:1})])),_:1}),d(s,{class:"rule-item"},{default:c((()=>[d(l,{class:"rule-bullet"},{default:c((()=>[p("•")])),_:1}),d(l,{class:"rule-text"},{default:c((()=>[p(f(_($)("components.productPurchase.earlyRedemptionMarketFluctuations")),1)])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1},8,["class"])])),_:1}),d(s,{class:"confirm-section"},{default:c((()=>[d(s,{class:"confirm-btn",onClick:Y},{default:c((()=>[d(l,{class:"confirm-text"},{default:c((()=>[p(f(_($)("components.productPurchase.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-1d4fc140"]]);export{$ as default};
