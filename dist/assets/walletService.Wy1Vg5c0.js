import{a as e,w as s}from"./apiService.Bl7qyh6B.js";const t=async()=>{try{if(void 0!==window.ethereum){const e=await window.ethereum.request({method:"eth_accounts"});return e.length>0?e[0]:null}return null}catch(e){return console.error("æ£€æŸ¥é’±åŒ…è¿æ¥å¤±è´¥:",e),null}},r=async(e,t)=>{try{if(!e)throw new Error("é’±åŒ…åœ°å€ä¸èƒ½ä¸ºç©º");if(!t)throw new Error("é“¾IDä¸èƒ½ä¸ºç©ºï¼ŒchainIdæ˜¯å¿…éœ€çš„å‚æ•°");if(!(e=>!!e&&"number"==typeof e&&e>0&&Number.isInteger(e))(t))throw new Error("é“¾IDæ ¼å¼æ— æ•ˆï¼Œå¿…é¡»æ˜¯10è¿›åˆ¶æ•°å­—");console.log("ğŸ”¥ è°ƒç”¨æŒ‘æˆ˜æ¥å£ /wallet/login/challengeï¼Œå‚æ•°:",{walletAddress:e,chainId:t,chainIdType:typeof t});const r=await s.createLoginChallenge(e,t);return console.log("âœ… æŒ‘æˆ˜æ¥å£å“åº”:",r),r}catch(r){throw console.error("âŒ åˆ›å»ºç­¾åæŒ‘æˆ˜å¤±è´¥:",r),console.error("é”™è¯¯è¯¦æƒ…:",{message:r.message,stack:r.stack,name:r.name}),r}},n=async()=>{try{console.log("ğŸš€ å¼€å§‹æ™ºèƒ½ç”¨æˆ·éªŒè¯...");const s=await(async()=>{try{console.log("ğŸ” å¼ºåˆ¶ä»åç«¯æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€...");const s=await e.getMe();return s&&s.success?(console.log("âœ… ä»åç«¯è·å–åˆ°ç”¨æˆ·å·²ç™»å½•çŠ¶æ€:",s.data),{isLoggedIn:!0,userData:s.data}):(console.log("âŒ åç«¯è¿”å›ç”¨æˆ·æœªç™»å½•çŠ¶æ€"),{isLoggedIn:!1,userData:null})}catch(s){return console.log("âŒ ä»åç«¯æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€å¤±è´¥:",s.message),{isLoggedIn:!1,userData:null}}})();if(s.isLoggedIn)return console.log("âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œè·³è¿‡é’±åŒ…éªŒè¯"),{success:!0,isLoggedIn:!0,userData:s.userData,skipWalletCheck:!0};console.log("âš ï¸ ç”¨æˆ·æœªç™»å½•ï¼Œéœ€è¦è¿›è¡Œé’±åŒ…éªŒè¯");const t=await a();return t.success?{success:!0,isLoggedIn:!0,walletAddress:t.walletAddress,userData:t.userData,token:t.token,skipWalletCheck:!1}:t}catch(s){return console.error("æ™ºèƒ½ç”¨æˆ·éªŒè¯å¤±è´¥:",s),{success:!1,error:"SMART_VERIFY_FAILED",message:s.message||"ç”¨æˆ·éªŒè¯å¤±è´¥"}}},a=async()=>{try{let e=await t();e||(e=await(async()=>{try{if(void 0!==window.ethereum)return(await window.ethereum.request({method:"eth_requestAccounts"}))[0];throw new Error("æœªæ£€æµ‹åˆ°MetaMaské’±åŒ…")}catch(e){throw console.error("è¿æ¥é’±åŒ…å¤±è´¥:",e),e}})());const n=await o();if(!n)return{success:!1,error:"CHAIN_ID_MISSING",message:"æ— æ³•è·å–å½“å‰ç½‘ç»œé“¾IDï¼Œè¯·ç¡®ä¿é’±åŒ…å·²è¿æ¥å¹¶åˆ‡æ¢åˆ°æ­£ç¡®çš„ç½‘ç»œ"};const a=await r(e,n),i=await(async(e,s)=>{try{if(void 0!==window.ethereum)return await window.ethereum.request({method:"personal_sign",params:[e,s]});throw new Error("æœªæ£€æµ‹åˆ°MetaMaské’±åŒ…")}catch(t){throw console.error("ç­¾åæ¶ˆæ¯å¤±è´¥:",t),t}})(a.data.challengeMessage,e),c={signature:i,signerAddress:e},u=await(async e=>{try{console.log("ğŸ”¥ è°ƒç”¨ç¡®è®¤æ¥å£ /wallet/login/confirmï¼Œå‚æ•°:",e);const t=await s.verifyLoginSignature(e);return console.log("âœ… ç¡®è®¤æ¥å£å“åº”:",t),t}catch(t){throw console.error("âŒ éªŒè¯ç­¾åå¤±è´¥:",t),t}})(c);return{success:!0,walletAddress:e,userData:u.userData,token:u.token}}catch(e){console.error("é’±åŒ…ç™»å½•å¤±è´¥:",e);const s=function(e){console.log("ğŸ” åˆ†æé’±åŒ…ç™»å½•é”™è¯¯:",e);const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);console.log("ğŸ“± è®¾å¤‡ä¿¡æ¯:",{userAgent:navigator.userAgent,platform:navigator.platform,isMobile:s,errorType:typeof e,errorKeys:Object.keys(e),errorMessage:e.message,errorStack:e.stack});const t={userMessage:"é’±åŒ…ç™»å½•å¤±è´¥",details:"",suggestions:[]};if(e.message){const s=e.message.toLowerCase();s.includes("network")||s.includes("fetch")||s.includes("timeout")||s.includes("connection")?(t.userMessage="ç½‘ç»œè¿æ¥å¤±è´¥",t.details="æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨",t.suggestions=["æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸","æ£€æŸ¥VPNè®¾ç½®","å°è¯•åˆ‡æ¢ç½‘ç»œ","ç¨åé‡è¯•"]):s.includes("wallet")||s.includes("metamask")||s.includes("provider")||s.includes("ethereum")?(t.userMessage="é’±åŒ…è¿æ¥å¤±è´¥",t.details="æ— æ³•è¿æ¥åˆ°MetaMaské’±åŒ…ï¼Œè¯·æ£€æŸ¥é’±åŒ…çŠ¶æ€",t.suggestions=["ç¡®ä¿MetaMaskå·²å®‰è£…å¹¶è§£é”","æ£€æŸ¥é’±åŒ…æ˜¯å¦è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œ","å°è¯•é‡æ–°è¿æ¥é’±åŒ…","åˆ·æ–°é¡µé¢åé‡è¯•"]):s.includes("user rejected")||s.includes("user denied")||s.includes("cancel")||s.includes("rejected")?(t.userMessage="ç”¨æˆ·å–æ¶ˆäº†æ“ä½œ",t.details="æ‚¨åœ¨MetaMaskä¸­å–æ¶ˆäº†é’±åŒ…è¿æ¥æˆ–ç­¾åè¯·æ±‚",t.suggestions=['è¯·é‡æ–°ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®',"åœ¨MetaMaskä¸­ç¡®è®¤è¿æ¥è¯·æ±‚","æ£€æŸ¥MetaMaskå¼¹çª—æ˜¯å¦è¢«é˜»æ­¢"]):s.includes("chain")||s.includes("network")||s.includes("unsupported")||s.includes("chainid")?(t.userMessage="ç½‘ç»œä¸æ”¯æŒ",t.details="å½“å‰ç½‘ç»œä¸è¢«æ”¯æŒï¼Œè¯·åˆ‡æ¢åˆ°æ­£ç¡®çš„ç½‘ç»œ",t.suggestions=["åˆ‡æ¢åˆ°BSCæµ‹è¯•ç½‘ (Chain ID: 97)","æ£€æŸ¥é’±åŒ…ç½‘ç»œè®¾ç½®","ç¡®ä¿ç½‘ç»œé…ç½®æ­£ç¡®"]):s.includes("signature")||s.includes("sign")||s.includes("personal_sign")||s.includes("signing")?(t.userMessage="æ¶ˆæ¯ç­¾åå¤±è´¥",t.details="æ— æ³•å®Œæˆæ¶ˆæ¯ç­¾åï¼Œå¯èƒ½æ˜¯é’±åŒ…é—®é¢˜æˆ–ç”¨æˆ·æ‹’ç»",t.suggestions=["åœ¨MetaMaskä¸­ç¡®è®¤ç­¾åè¯·æ±‚","æ£€æŸ¥ç­¾åæ¶ˆæ¯å†…å®¹","é‡æ–°å°è¯•ç­¾åæ“ä½œ"]):s.includes("server")||s.includes("500")||s.includes("502")||s.includes("503")||s.includes("http")?(t.userMessage="æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨",t.details="æœåŠ¡å™¨å¯èƒ½æ­£åœ¨ç»´æŠ¤æˆ–é‡åˆ°æŠ€æœ¯é—®é¢˜",t.suggestions=["ç¨åé‡è¯•","æ£€æŸ¥æœåŠ¡çŠ¶æ€","è”ç³»å®¢æœæ”¯æŒ"]):s.includes("auth")||s.includes("unauthorized")||s.includes("401")||s.includes("login")?(t.userMessage="è®¤è¯å¤±è´¥",t.details="ç”¨æˆ·è®¤è¯ä¿¡æ¯æ— æ•ˆæˆ–å·²è¿‡æœŸ",t.suggestions=["é‡æ–°ç™»å½•","æ¸…é™¤æµè§ˆå™¨ç¼“å­˜","æ£€æŸ¥ç™»å½•çŠ¶æ€"]):s.includes("mobile")||s.includes("android")||s.includes("ios")||s.includes("phone")?(t.userMessage="ç§»åŠ¨ç«¯è¿æ¥é—®é¢˜",t.details="ç§»åŠ¨ç«¯é’±åŒ…è¿æ¥å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜",t.suggestions=["ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„MetaMask","å°è¯•åœ¨æ¡Œé¢ç«¯æ“ä½œ","æ£€æŸ¥ç§»åŠ¨ç«¯ç½‘ç»œè®¾ç½®","è”ç³»æŠ€æœ¯æ”¯æŒ"]):(t.userMessage="è¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•",t.details=`å‘ç”ŸæœªçŸ¥é”™è¯¯: ${e.message}`,t.suggestions=["åˆ·æ–°é¡µé¢åé‡è¯•","æ£€æŸ¥é’±åŒ…çŠ¶æ€","è”ç³»æŠ€æœ¯æ”¯æŒ","æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—"])}e.message||(t.userMessage="è¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•",t.details="é’±åŒ…è¿æ¥è¿‡ç¨‹ä¸­å‘ç”ŸæœªçŸ¥é”™è¯¯",t.suggestions=["åˆ·æ–°é¡µé¢åé‡è¯•","æ£€æŸ¥é’±åŒ…çŠ¶æ€","è”ç³»æŠ€æœ¯æ”¯æŒ"]);return console.log("ğŸ“‹ é”™è¯¯åˆ†æç»“æœ:",t),console.log("ğŸ” æœ€ç»ˆé”™è¯¯ä¿¡æ¯:",{"ç”¨æˆ·æ¶ˆæ¯":t.userMessage,"é”™è¯¯è¯¦æƒ…":t.details,"è§£å†³å»ºè®®":t.suggestions,"è®¾å¤‡ç±»å‹":s?"ç§»åŠ¨ç«¯":"æ¡Œé¢ç«¯","åŸå§‹é”™è¯¯":e.message}),t}(e);if(e.response&&400===e.response.status){const t=e.response.data;if("WALLET_NOT_BOUND"===t.code)return{success:!1,error:"WALLET_NOT_BOUND",message:t.message||"é’±åŒ…æœªç»‘å®šç”¨æˆ·è´¦æˆ·",details:s.details,suggestions:s.suggestions}}return{success:!1,error:"LOGIN_FAILED",message:s.userMessage,details:s.details,suggestions:s.suggestions}}},o=async()=>{try{if(void 0!==window.ethereum){const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)}return null}catch(e){return console.error("è·å–é“¾IDå¤±è´¥:",e),null}};export{t as c,n as s};
